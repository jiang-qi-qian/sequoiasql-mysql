#Check table options
#Case 18020#Case 18021#Case 18022#Case 18023#Case 18024#Case 18025#Case 18026#Case 18027#Case 18028
#Case 18038#Case 18039#Case 18040#Case 18041#Case 18042#Case 18657#Case 18658#Case 18660#Case 19442
#Case 19355#Case 19357#Case 19388#Case 19389#Case 19356#Case 19358#Case 19359#Case 19360#Case 19361#Case 19362
#Case 19363#Case 19364#Case 19365#Case 19366#Case 19367#Case 19368#Case 19369#Case 19370#Case 19523
#Case 19371#Case 19372#Case 19373#Case 19374#Case 19390#Case 19391#Case 19394#Case 19392#Case 19375
#Case 19393#Case 19376#Case 19408#Case 19409#Case 19410#Case 19377#Case 19378#Case 19379#Case 19380
#Case 19381#Case 19382#Case 19395#Case 19397#Case 19398#Case 19403#Case 19407#Case 20023#Case 20024
#Case 20028#Case 20227#Case 20230#Case 20231#Case 20232#Case 20233#Case 20234#Case 20235#Case 20236
#Case 20254#Case 20256#Case 20422#Case 20386#Case 20388#Case 20389#Case 20390#Case 20396#Case 20397
#Case 20398#Case 20399#Case 20473#Case 20474#Case 20524#Case 21866#Case 21871#Case 21872#Case 21873
#Case 22221#Case 22487#Case 22488#Case 22490#Case 22490#Case 22494#Case 22495#Case 22786#Case 22787
#Case 22789

--source include/have_sequoiadb.inc
create database test_alter;
use test_alter;
--disable_query_log
create table reserved(a int primary key)ENGINE=sequoiadb COMMENT='sequoiadb:{ auto_partition: true }';
--enable_query_log

#alter comment
#Case 20256
create table t1(a int key);
insert into t1 values(1),(2);
alter table t1 comment "string", ALGORITHM=inplace;
show create table t1;
#Bug #SEQUOIASQLMAINSTREAM-241
alter table t1 comment "string",ALGORITHM=COPY;
show create table t1;
alter table t1 comment "{table_options:{ShardingKey:{a:1}},ShardingType:'range',Compressed:true,CompressionType:'lzw',ReplSize:3}", ALGORITHM=inplace;
show create table t1;
alter table t1 comment "string, sequoiadb:{ table_options: { AutoIndexId: false, Compressed: false } }", ALGORITHM=inplace;
show create table t1;
select * from t1;
drop table t1;

#Case 18028
create table t1(a int, b char(16));
insert into t1 values(1,'a'),(2,'b');
--error 40006
alter table t1 comment = "sequoiadb:{ table_options: { ShardingKey: { a: 1 }, ShardingType: \"range\",  other: \"other\" } }", ALGORITHM=inplace; 
show create table t1;
select * from t1 order by a;
drop table t1;

#Case 20227
create table t1(a int, b char(16)); 
create table t2(a int, b char(16)); 
insert into t1 values(1,'a'),(2,'b'); 
insert into t2 values(1,'a'),(2,'b'); 
--error 40006                                         
alter table t1 comment = "sequoiadb:{ table_options: { ShardingKey: { a: 1 }, IsMainCL: true } }", ALGORITHM=inplace;
--error 40006                                         
alter table t2 comment = "sequoiadb:{ table_options: { Group: \"group4\" } }", ALGORITHM=inplace;
show create table t1;                                          
show create table t2;                                          
alter table t1 comment = "sequoiadb:{ table_options: { ShardingKey: { a: 1 }, ShardingType: \"hash\", Partition: 1024, ReplSize:2, Compressed: true, CompressionType: \"lzw\", AutoSplit: true, EnsureShardingIndex: false } }", ALGORITHM=inplace;
alter table t2 comment = "sequoiadb:{ table_options: { ShardingKey: { a: 1 }, ShardingType: \"range\", AutoIndexId: false, StrictDataMode:true } }", ALGORITHM=inplace;
show create table t1;
show create table t2;
select * from t1 order by a;
select * from t2 order by a;
drop table t1,t2;

#Case 20230 #Case 20231
create table t1(a int, b char(16)) comment = "sequoiadb:{ table_options: { ReplSize:2, Compressed: true, CompressionType: \"snappy\" } }"; 
create table t2(a int, b char(16)) comment = "sequoiadb:{ table_options: { AutoIndexId: false, StrictDataMode:true, ReplSize:2, Compressed: true, CompressionType: \"snappy\" } }";
insert into t1 values(1,'a'),(2,'b');
--error 40006                                         
alter table t1 comment = "sequoiadb:{ table_options: { ShardingKey: { a: 1 }, ReplSize:2, Compressed: true, CompressionType: \"snappy\", IsMainCL: true } }", ALGORITHM=inplace;
--error 40006                                         
alter table t2 comment = "sequoiadb:{ table_options: { Group: \"group4\", AutoIndexId: false, StrictDataMode:true, ReplSize:2, Compressed: true, CompressionType: \"snappy\" } }", ALGORITHM=inplace;
show create table t1;     
show create table t2;    
alter table t1 comment = "sequoiadb:{ table_options: { ShardingKey: { a: 1 }, ShardingType: \"range\", EnsureShardingIndex: false, AutoIndexId: true, StrictDataMode: true, ReplSize: 2, Compressed: true, CompressionType: \"snappy\" } }", ALGORITHM=inplace;
alter table t2 comment = "sequoiadb:{ table_options: { AutoIndexId: true, StrictDataMode: false, ReplSize: 4, Compressed: true, CompressionType: \"lzw\" } }", ALGORITHM=inplace;
show create table t1;
show create table t2;
select * from t1 order by a;
select * from t2 order by a;
drop table t1,t2;

#Case 20232
create table t1(a int primary key, b char(16));
insert into t1 values(1,'a'),(2,'b');
--error 40032
alter table t1 comment = "sequoiadb:{ table_options: { ShardingKey: { a: 1 }, ShardingType: \"range\" } }", ALGORITHM=inplace;
--error 40006                                         
alter table t1 comment = "sequoiadb:{ table_options: { ShardingKey: { a: 1 }, IsMainCL: true } }", ALGORITHM=inplace;
--error 40006                                         
alter table t1 comment = "sequoiadb:{ table_options: { Group: \"group4\" } }";
show create table t1;
alter table t1 comment = "sequoiadb:{ table_options: { AutoIndexId: true, StrictDataMode: true, ReplSize: 2, Compressed: true, CompressionType: \"snappy\" } }", ALGORITHM=inplace;
show create table t1;
select * from t1 order by a;
drop table t1;

#Case 20233 #Case 20234
create table t1(a int primary key, b char(16)) comment = "sequoiadb:{ table_options: { ShardingKey: { a : 1 }, ReplSize:2, Compressed: true, CompressionType: \"snappy\" } }";
create table t2(a int, b char(16)) comment = "sequoiadb:{ table_options: { Compressed: false, ShardingKey: { a: 1 }, ShardingType: \"range\" } }";
insert into t1 values(1,'a'),(2,'b');
insert into t2 values(1,'a'),(2,'b');
--error 131
alter table t1 comment = "sequoiadb:{ table_options: { ShardingKey: { a : 1 }, ShardingType: \"range\", ReplSize: 2, Compressed: true, AutoIndexId:false } }", ALGORITHM=inplace;
--error 131
alter table t1 comment = "sequoiadb:{ table_options: { ShardingKey: { a : 1 }, Compressed: true, CompressionType: \"lzw\" } }";
--error 40032
alter table t1 comment = "sequoiadb:{ table_options: { ShardingKey: { a : 1 }, ShardingType: \"range\", ReplSize: 2, Compressed: true, CompressionType: \"snappy\" } }", ALGORITHM=inplace;
--error 40006
alter table t2 comment = "sequoiadb:{ table_options: { Compressed: false, ShardingKey: { a: 1 }, ShardingType: \"range\", IsMainCL: true} }", ALGORITHM=inplace;
--error 40006
alter table t2 comment = "sequoiadb:{ table_options: { ShardingKey: { a: 1 },  ShardingType: \"range\", Compressed: true, IsMainCL: true, EnsureShardingIndex: false } }", ALGORITHM=inplace;
show create table t1;    
show create table t2;   
alter table t1 comment = "sequoiadb:{ table_options: { ShardingKey: { a : 1 }, ReplSize:2, Compressed: true, CompressionType: \"snappy\", StrictDataMode: true } }", ALGORITHM=inplace;
alter table t2 comment = "sequoiadb:{ table_options: { Compressed: false, ShardingKey: { a: 1 }, ShardingType: \"range\", StrictDataMode: true, ReplSize: 4, AutoIndexId: false } }", ALGORITHM=inplace;
show create table t1;                                                    
show create table t2;                                
alter table t1 comment = "sequoiadb:{ table_options: { ShardingKey: { a : 1 }, ReplSize:5, Compressed: true, CompressionType: \"lzw\", StrictDataMode: false, AutoIndexId:false  } }", ALGORITHM=inplace;
alter table t2 comment = "sequoiadb:{ table_options: { Compressed: false, ShardingKey: { a: 1 }, ShardingType: \"range\", StrictDataMode: false, ReplSize: 3, AutoIndexId: true } }", ALGORITHM=inplace;
show create table t1;
show create table t2;
select * from t1 order by a;                          
select * from t2 order by a;                          
drop table t1,t2;            

#Case 20235
create table t1(a int, b char(16)) comment = "sequoiadb:{ table_options: { ShardingKey: { a: 1 }, IsMainCL: true } }";
--error 40006 
alter table t1 comment = "sequoiadb:{ table_options: { ShardingKey: { a: 1 }, IsMainCL: false, EnsureShardingIndex: false } }", ALGORITHM=inplace;
show create table t1;
drop table t1;

#Case 20236
create table t1(a int, b char(16));
create table t2(a int primary key, b char(16));
create table t3(a int primary key, b char(16)) comment = "sequoiadb:{ auto_partition : false }";
insert into t1 values(1,'a'),(2,'b');
insert into t2 values(1,'a'),(2,'b');
insert into t3 values(1,'a'),(2,'b');
alter table t1 comment = "sequoiadb:{ table_options: { Compressed: false, StrictDataMode: true, AutoIndexId: false, ReplSize: 4 }, auto_partition: true }", ALGORITHM=inplace;
--error 131
alter table t2 comment = "sequoiadb:{ table_options: { Compressed: false, StrictDataMode: true, AutoIndexId: false, ReplSize: 4 }, auto_partition: false }", ALGORITHM=inplace;
--error 131
alter table t3 comment = "sequoiadb:{ auto_partition : true }", ALGORITHM=inplace;
show create table t3;
alter table t3 comment = "sequoiadb:{ auto_partition : false }", ALGORITHM=inplace;
show create table t1;
show create table t2;
show create table t3;
select * from t1 order by a;
select * from t2 order by a;
select * from t3 order by a;
drop table t1,t2,t3;

#Case 20254
create table t1(a int, b char(16)) comment = "sequoiadb:{ table_options: { ShardingKey: { a : 1 }, ShardingType:\"hash\" } }"; 
insert into t1 values(1,'a'),(2,'b');
--error 40006
alter table t1 comment = "sequoiadb:{ table_options: { ShardingKey: \"123\", ShardingType:\"hash\"} }"; 
--error 40006
alter table t1 comment = "sequoiadb:{ table_options: { ShardingKey: {a:1}, ShardingType:true} }";
show create table t1;
select * from t1 order by a;
drop table t1;

#alter characterset
create table t1(a varchar(255) key);
insert into t1 values('a'),('b');
alter table t1 character set = 'ucs2';
show create table t1;
insert into t1 values ('c');
select * from t1;
alter table t1 character set = 'utf8', ALGORITHM=COPY;
show create table t1;
insert into t1 values ('d');
select * from t1;

alter table t1 convert to character set 'UTF8';
show create table t1;
insert into t1 values ('e');
select * from t1;
alter table t1 convert to character set 'cp1251',ALGORITHM=COPY;
show create table t1;
insert into t1 values ('f');
select * from t1;
drop table t1;

#rename table 
create table t1(a int key);
insert into t1 values(1),(2);
alter table t1 rename t2,force;
insert into t2 values(3);
show create table t2;
select * from t2;
alter table t2 rename t3,ALGORITHM=COPY;
insert into t3 values(4);
show create table t3;
select * from t3;
drop table if exists t1,t2,t3;

#alter engine
create table t1(a int key);
insert into t1 values(1),(2);
alter table t1 engine innodb;
show create table t1;
select * from t1;
alter table t1 engine sequoiadb;
show create table t1;
select * from t1;
--error 1845
alter table t1 engine innodb,ALGORITHM=inplace;
alter table t1 engine sequoiadb,ALGORITHM=inplace;
drop table t1;

#alter tablespace
create table t1(a int key);
insert into t1 values(1),(2);
alter table t1 tablespace ts,ALGORITHM=inplace;
show create table t1;
select * from t1;
alter table t1 tablespace ts,ALGORITHM=copy;
show create table t1;
select * from t1;

#optimize table
optimize table t1;

#BUG SEQUOIASQLMAINSTREAM-247
#alter all table option with sequoiadb not support
--error 1210
alter table t1 MIN_ROWS 10 MAX_ROWS 100 AVG_ROW_LENGTH 50 PACK_KEYS 1 CHECKSUM 1 ROW_FORMAT COMPRESSED DELAY_KEY_WRITE 1 KEY_BLOCK_SIZE 10 COMPRESSION "ZLIB" INSERT_METHOD first UNION (t3) DATA DIRECTORY "/tmp" INDEX DIRECTORY "/tmp" PASSWORD "12345" CONNECTION "12345" STATS_PERSISTENT 1 STATS_AUTO_RECALC 1 STATS_SAMPLE_PAGES 1 TABLESPACE ts STORAGE disk;

#alter options combination
alter table t1 rename t2,character set = 'utf8';
show create table t2;
select * from t2;

alter table t2 rename t1, MIN_ROWS 10 MAX_ROWS 100;
show create table t1;
select * from t1;

#Bug #SEQUOIASQLMAINSTREAM-241
alter table t1 rename t2, comment "rename table and add comment";
select * from t2;
alter table t2 rename t1;

alter table t1 comment "alter comment" MIN_ROWS 10 MAX_ROWS 100;
select * from t1;

drop table if exists t1,t2;

# alter primary key for not partition table
create table t1(a char(255) default null);
insert into t1 values ('a'),('1'),('c'),(NULL);
#BUG #SEQUOIASQLMAINSTREAM-813
--error 1138
alter table t1 add primary key(a);
show create table t1;
delete from t1 where a is null;
select * from t1;
alter table t1 add primary key(a);
show create table t1;
alter table t1 drop primary key,add primary key(a);
show create table t1;
alter table t1 drop primary key;
show create table t1;
alter table t1 add unique key a(a);
show create table t1;
alter table t1 drop key a;
show create table t1;
drop table t1;

# alter unique key for not partition table
create table t1(a char(255) default null);
insert into t1 values ('a'),('c'),(NULL),(NULL),(NULL);
alter table t1 add unique index a(a);
show create table t1;
select * from t1 where a > '';
alter table t1 drop index a;
show create table t1;
drop table t1;

# alter primary and unique key for partition table
create table t1(a char(255), b bigint, primary key(a));
show create table t1;
--error 1048
insert into t1 values (NULL, 1);
insert into t1 values ('a', 2),('1', 3),('c', 4);
--error 40177 
alter table t1 drop primary key, add primary key(b);
show create table t1;
alter table t1 drop primary key, add primary key(b,a);
show create table t1;
select * from t1 where a > '' and b >= 1 order by b;
alter table t1 drop primary key;
--error 40177
alter table t1 add unique index b(b);
alter table t1 add unique index b(b,a);
show create table t1;
select * from t1 where a > '' and b >= 1 order by b;
alter table t1 drop index b;
show create table t1;
drop table t1;

# rename index
create table t1(a varchar(16) unique key);
insert into t1 values ('a'),('c'),('n'),(NULL);
--error 138
alter table t1 rename index a to a_new, algorithm=inplace;
show create table t1;
alter table t1 rename index a to a_new, algorithm=copy;
show create table t1;
select * from t1 where a > '';
drop table t1;

# not support fulltext and spatial index 
create table t1(a int);
--error 1214
alter table t1 add fulltext index a(a);
--error 1464
alter table t1 add spatial index a(a);
drop table t1;

# alter index attribute
create table t1(a int unique key, b char(16), c float);
alter table t1 drop index a, add index a(a) comment 'recreate index' using hash;
show create table t1;
alter table t1 drop index a, add index b(b) key_block_size=2 using btree;
show create table t1;
alter table t1 drop index b,add index b(a) key_block_size=101 using hash;
show create table t1;
alter table t1 drop index b,add index b_new(a) using hash;
show create table t1;
alter table t1 drop index b_new, add index ab(b,a) using btree;
show create table t1;
alter table t1 drop index ab, add index ab(a,b), add index b(b);
show create table t1;
alter table t1 drop index ab;
alter table t1 drop index b;
alter table t1 add index a(a), add index b(b), add index c(c), add index abc(a,b,c);
show create table t1;
drop table t1;

#alter column
#Bug #SEQUOIASQLMAINSTREAM-288
create table t1 (a int not null auto_increment, b int, c int, index(a) )comment="sequoiadb:{ table_options: { ShardingKey: { c: 1 }, ShardingType: 'hash', AutoSplit:true } }";
insert into t1 values(1,1,1);
insert into t1 values(2,2,2);
select * from t1 order by a;
alter table t1 drop b;
show create table t1;
insert into t1 values();
select * from t1 order by a;
alter table t1 drop a;
insert into t1 values();
select * from t1 order by c;
drop table t1;

#alter references
CREATE TABLE t1 (a INT PRIMARY KEY);
CREATE TABLE t2 (b INT);
ALTER TABLE t2 ADD CONSTRAINT FOREIGN KEY(b) REFERENCES t1(a),ALGORITHM=inplace;
drop table if exists t1,t2;

#alter index length
CREATE TABLE t1 (a VARCHAR(100));
ALTER TABLE t1 ADD INDEX char_idx(a);
ALTER TABLE t1 MODIFY a VARCHAR(200),ALGORITHM=inplace;
drop table if exists t1;

#
# check alter auto_increment
#
CREATE TABLE t1 ( id INT(11) NOT NULL, num INT(11) NOT NULL, agent_org_no VARCHAR(200), agent_name VARCHAR(200), create_time DATETIME, update_time DATETIME, PRIMARY KEY(id), UNIQUE KEY `判断添加还是修改` (id, agent_org_no) USING BTREE, KEY `代>理商名` (agent_name) USING BTREE ) ENGINE=SequoiaDB COMMENT='sequoiadb:{"table_options":{"ShardingType":"hash","ShardingKey":{"id":1},"Partition":4096,"ReplSize":2,"Compressed":true,"CompressionType":"lzw","AutoSplit":true,"EnsureShardingIndex":true}}';
SHOW CREATE TABLE t1; 
INSERT INTO t1 VALUES (10,10,'a','a','2019-01-01 00:00:00','2019-01-02 00:00:00'),(20,20,'b','b','2019-11-11 00:00:00','2019-12-12 00:00:00');

# create auto_increment
ALTER TABLE t1 CHANGE id id INT AUTO_INCREMENT;
SHOW CREATE TABLE t1;
INSERT INTO t1(num, agent_org_no, agent_name, create_time, update_time) values (21,'ab','ab','2019-01-01 00:00:00','2019-01-02 00:00:00'),(22,'cd','cd','2019-11-11 00:00:00','2019-12-12 00:00:00'), (23,'ef','ef','2020-09-09 00:00:00','2020-07-07 00:00:00');
--sorted_result
SELECT * FROM t1;

# change auto_increment
ALTER TABLE t1 ADD INDEX idx_num(num); 
ALTER TABLE t1 CHANGE id id int, CHANGE num num int AUTO_INCREMENT; 
SHOW CREATE TABLE t1;
INSERT INTO t1(id, agent_org_no, agent_name, create_time, update_time) values (31,'ab','ab','2019-01-01 00:00:00','2019-01-02 00:00:00'),(32,'cd','cd','2019-11-11 00:00:00','2019-12-12 00:00:00'), (33,'ef','ef','2020-09-09 00:00:00','2020-07-07 00:00:00');
#BUG #SEQUOIASQLMAINSTREAM-332
--sorted_result                                                                
SELECT * FROM t1;

# drop auto_increment
ALTER TABLE t1 MODIFY num INT DEFAULT 0; 
SHOW CREATE TABLE t1;   
INSERT INTO t1(id, agent_org_no, agent_name, create_time, update_time) VALUES (40,'C','C','2019-01-01 00:00:00','2019-01-02 00:00:00'),(41,'D','D','2031-01-11 00:00:00','2019-08-30 00:00:00');
#BUG #SEQUOIASQLMAINSTREAM-332
--sorted_result
SELECT * FROM t1;
DROP TABLE t1;

#BUG #SEQUOIASQLMAINSTREAM-391
create table t1 (a int);
insert into t1(a) values(1); 
alter table t1 add i int key;
select * from t1;
alter table t1 drop primary key;
select * from t1;
alter table t1 add j int unique key;
select * from t1;
drop table t1;

#Case #19355 #Case #19356
create table t1(id int auto_increment key, a int, b int, c int);
insert into t1(a, b, c) values(1,1,1),(2,2,2),(3,3,3),(4,4,4),(5,5,5),(6,6,6),(7,7,7),(8,8,8),(9,9,9),(10,10,10);
ALTER TABLE t1 ADD d int FIRST,algorithm = inplace;
ALTER TABLE t1 ADD e int after a, algorithm = inplace;
show create table t1;
insert into t1(a, b, c, d, e) values(11,11,11,11,11);
select * from t1 order by id;
ALTER TABLE t1 ADD (f int, g int), algorithm = inplace;
insert into t1(a, b, c, d, e, f, g) values(12,12,12,12,12,12,12);
select * from t1 order by id;

#Case #19388
alter table t1 drop column g, algorithm = inplace;
show create table t1;
insert into t1(a, b, c, d, e, f) values(13,13,13,13,13,13);
select * from t1 order by id;
drop table t1;

#Case #19357 #Case #19358 #Case #19359 #Case #19360 #Case #19361 #Case #19362 #Case #19363 #Case #19364 #Case #19365 #Case #19366 #Case #19367 #Case #19368 #Case #19369 #Case #19370 #Case 19389#Case #19523
set sql_mode = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION';
create table t1(id int auto_increment key);
insert into t1 values(),(),(),(),(),(),(),(),(),();
ALTER TABLE t1 ADD (col1 int NOT NULL, col2 float NOT NULL, col3 decimal(10,2) NOT NULL, col4 bit(2) NOT NULL, col8 time NOT NULL, col9 year NOT NULL, col10 char NOT NULL, col11 varchar(255) NOT NULL, col12 binary NOT NULL, col13 varbinary(255) NOT NULL, col14 text NOT NULL, col15 blob NOT NULL, col16 enum('one', 'two', 'three') NOT NULL, col17 set('one', 'two', 'three') NOT NULL, col18 json NOT NULL), algorithm = inplace;
alter table t1 ADD(col5 date NOT NULL),algorithm = inplace;
alter table t1 ADD(col6 datetime NOT NULL),algorithm = inplace;
-- error 1846
alter table t1 ADD(col7 timestamp NOT NULL),algorithm = inplace;
show create table t1;
insert into t1(col1, col2, col3, col4, col5, col6, col8, col9, col10, col11, col12, col13, col14, col15, col16, col17, col18) values(100, 12.12, 15.15, 3, '2019-09-20', '2019-09-20 17:39:30', '10:10:10', '2019', 'a', 'abc', 'a', 'abc', 'abc', 'abc', 'two', 'two', '{"a":1}');
select * from t1 order by id;
set sql_mode = default;

alter table t1 drop column col1,algorithm = inplace;
alter table t1 drop column col2,algorithm = inplace;
alter table t1 drop column col3,algorithm = inplace;
alter table t1 drop column col4,algorithm = inplace;
alter table t1 drop column col5,algorithm = inplace;
alter table t1 drop column col6,algorithm = inplace;
alter table t1 drop column col8,algorithm = inplace;
alter table t1 drop column col9,algorithm = inplace;
alter table t1 drop column col10,algorithm = inplace;
alter table t1 drop column col11,algorithm = inplace;
alter table t1 drop column col12,algorithm = inplace;
alter table t1 drop column col13,algorithm = inplace;
alter table t1 drop column col14,algorithm = inplace;
alter table t1 drop column col15,algorithm = inplace;
alter table t1 drop column col16,algorithm = inplace;
alter table t1 drop column col17,algorithm = inplace;
alter table t1 drop column col18,algorithm = inplace;
show create table t1;
insert into t1 values();
select * from t1 order by id;

#Case #19371
ALTER TABLE t1 ADD (col1 int NOT NULL default 100, col2 float NOT NULL default 100.2, col3 decimal(10,2) NOT NULL default 30.23, col4 bit(2) NOT NULL default 2, col5 date NOT NULL default '2019-09-21', col6 datetime NOT NULL default '2019-09-21 11:06:31', col7 timestamp NOT NULL default '2019-09-21 11:06:31', col8 time NOT NULL default '11:04:31', col9 year NOT NULL default 2019, col10 char(255) NOT NULL default 'char', col11 varchar(255) NOT NULL default 'varchar', col12 binary(255) NOT NULL default 'binary', col13 varbinary(255) NOT NULL default 'varbinary', col16 enum('one', 'two', 'three') NOT NULL default 'three', col17 set('one', 'two', 'three') NOT NULL default 'two'), algorithm = inplace;
show create table t1;
insert into t1 values();
insert into t1(col1, col2, col3, col4, col5, col6, col7, col8, col9, col10, col11, col12, col13, col16, col17) values(100, 12.12, 15.15, 3, '2019-09-20', '2019-09-21 17:39:30', '2019-09-20 17:39:30', '10:10:10', '2019', 'a', 'abc', 'a', 'abc', 'two', 'three');
select * from t1 order by id;

alter table t1 drop column col1,algorithm = inplace;
alter table t1 drop column col2,algorithm = inplace;
alter table t1 drop column col3,algorithm = inplace;
alter table t1 drop column col4,algorithm = inplace;
alter table t1 drop column col5,algorithm = inplace;
alter table t1 drop column col6,algorithm = inplace;
alter table t1 drop column col7,algorithm = inplace;
alter table t1 drop column col8,algorithm = inplace;
alter table t1 drop column col9,algorithm = inplace;
alter table t1 drop column col10,algorithm = inplace;
alter table t1 drop column col11,algorithm = inplace;
alter table t1 drop column col12,algorithm = inplace;
alter table t1 drop column col13,algorithm = inplace;
alter table t1 drop column col16,algorithm = inplace;
alter table t1 drop column col17,algorithm = inplace;

ALTER TABLE t1 ADD (col1 int default 100, col2 float default 100.2, col3 decimal(10,2) default 30.23, col4 bit(2) default 2, col5 date default '2019-09-21', col6 datetime default '2019-09-21 11:06:31', col7 timestamp default '2019-09-21 11:06:31', col8 time default '11:04:31', col9 year default 2019, col10 char(255) default 'char', col11 varchar(255) default 'varchar', col12 binary(255) default 'binary', col13 varbinary(255) default 'varbinary', col16 enum('one', 'two', 'three') default 'three', col17 set('one', 'two', 'three') default 'two'), algorithm = inplace;
show create table t1;
insert into t1 values();
insert into t1(col1, col2, col3, col4, col5, col6, col7, col8, col9, col10, col11, col12, col13, col16, col17) values(100, 12.12, 15.15, 3, '2019-09-20', '2019-09-21 17:39:30', '2019-09-20 17:39:30', '10:10:10', '2019', 'a', 'abc', 'a', 'abc', 'two', 'three');
select * from t1 order by id;
delete from t1;
insert into t1(col1, col2, col3, col4, col5, col6, col7, col8, col9, col10, col11, col12, col13, col16, col17) values(NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL);
--replace_column 8 x
select * from t1;
drop table t1;

#Case #19372
#SEQUOIASQLMAINSTREAM-434
#create table t1(id int);
#insert into t1 values(1), (2), (3), (4), (5), (6), (7), (8), (9), (10);
#ALTER TABLE t1 ADD (col1 int AUTO_INCREMENT KEY), algorithm = inplace;
#show create table t1;
#insert into t1 values(11);
#insert into t1 values(12, 10000);
#insert into t1 values(13);
#select * from t1 order by id;
#drop table t1;
#
#create table t1(id int)comment="sequoiadb:{ table_options: { ShardingKey: { id: 1 }, ShardingType: 'hash', AutoSplit:true } }";
#insert into t1 values(1), (2), (3), (4), (5), (6), (7), (8), (9), (10);
#ALTER TABLE t1 ADD (col1 int AUTO_INCREMENT, primary key(id, col1)), algorithm = inplace;
#show create table t1;
#insert into t1 values(11);
#insert into t1 values(12, 10000);
#insert into t1 values(13);
#select * from t1 order by id;
#drop table t1;

#Case #19373
#SEQUOIASQLMAINSTREAM-434
#create table t1(id int);
#insert into t1 values(1), (2), (3), (4), (5), (6), (7), (8), (9), (10);
#ALTER TABLE t1 ADD (col1 int AUTO_INCREMENT UNIQUE KEY), algorithm = inplace;
#show create table t1;
#insert into t1 values(11);
#insert into t1 values(12, 10000);
#insert into t1 values(13);
#select * from t1 order by id;
#drop table t1;
#
#create table t1(id int)comment="sequoiadb:{ table_options: { ShardingKey: { id: 1 }, ShardingType: 'hash', AutoSplit:true } }";
#insert into t1 values(1), (2), (3), (4), (5), (6), (7), (8), (9), (10);
#ALTER TABLE t1 ADD (col1 int AUTO_INCREMENT, unique key(id, col1)), algorithm = inplace;
#show create table t1;
#insert into t1 values(11);
#insert into t1 values(12, 10000);
#insert into t1 values(13);
#select * from t1 order by id;
#drop table t1;

#Case #19374
#SEQUOIASQLMAINSTREAM-434
#create table t1(id int);
#insert into t1 values(1), (2), (3), (4), (5), (6), (7), (8), (9), (10);
#ALTER TABLE t1 ADD (col1 int AUTO_INCREMENT, index(col1)), algorithm = inplace;
#show create table t1;
#insert into t1 values(11);
#insert into t1 values(12, 10000);
#insert into t1 values(13);
#select * from t1 order by id;
#drop table t1;
#
#create table t1(id int)comment="sequoiadb:{ table_options: { ShardingKey: { id: 1 }, ShardingType: 'hash', AutoSplit:true } }";
#insert into t1 values(1), (2), (3), (4), (5), (6), (7), (8), (9), (10);
#ALTER TABLE t1 ADD (col1 int AUTO_INCREMENT, index(id, col1)), algorithm = inplace;
#show create table t1;
#insert into t1 values(11);
#insert into t1 values(12, 10000);
#insert into t1 values(13);
#select * from t1 order by id;
#drop table t1;


#Case #19390
create table t1(id int, col1 int AUTO_INCREMENT key)comment="sequoiadb:{ auto_partition: false }";
insert into t1(id) values(1), (2), (3), (4), (5), (6), (7), (8), (9), (10);
show create table t1;
select * from t1 order by id;
ALTER TABLE t1 DROP col1, algorithm = inplace;
show create table t1;
insert into t1 values(11);
select * from t1 order by id;
drop table t1;

create table t1(id int, col1 int AUTO_INCREMENT, col2 varchar(255), primary key(col2, id, col1))comment="sequoiadb:{ table_options: { ShardingKey: { id: 1 }, ShardingType: 'hash', AutoSplit:true } }";
insert into t1(id, col2) values(1, 'var1'), (2, 'var2'), (3, 'var3'), (4, 'var4'), (5, 'var5'), (6, 'var6'), (7, 'var7'), (8, 'var8'), (9, 'var9'), (10, 'var10');
show create table t1;
select * from t1 order by col1;
ALTER TABLE t1 DROP col1, algorithm = inplace;
show create table t1;
insert into t1(id, col2) values(11, 'var11');
select * from t1 order by id;
drop table t1;

#Case #19391
create table t1(id int, col1 int AUTO_INCREMENT unique key)COMMENT='sequoiadb:{ auto_partition: false }';
insert into t1(id) values(1), (2), (3), (4), (5), (6), (7), (8), (9), (10);
show create table t1;
select * from t1 order by id;
ALTER TABLE t1 DROP col1, algorithm = inplace;
show create table t1;
insert into t1 values(11);
select * from t1 order by id;
drop table t1;

create table t1(id int not null, col1 int AUTO_INCREMENT, col2 varchar(255) not null, unique key(col2, id, col1))comment="sequoiadb:{ table_options: { ShardingKey: { id: 1 }, ShardingType: 'hash', AutoSplit:true } }";
insert into t1(id, col2) values(1, 'var1'), (2, 'var2'), (3, 'var3'), (4, 'var4'), (5, 'var5'), (6, 'var6'), (7, 'var7'), (8, 'var8'), (9, 'var9'), (10, 'var10');
show create table t1;
select * from t1 order by col1;
ALTER TABLE t1 DROP col1, algorithm = inplace;
show create table t1;
insert into t1(id, col2) values(11, 'var11');
select * from t1 order by id;
drop table t1;

#Case #19392
create table t1(id int, col1 int AUTO_INCREMENT ,index(col1));
insert into t1(id) values(1), (2), (3), (4), (5), (6), (7), (8), (9), (10);
show create table t1;
select * from t1 order by id;
ALTER TABLE t1 DROP col1, algorithm = inplace;
show create table t1;
insert into t1 values(11);
select * from t1 order by id;
drop table t1;

create table t1(id int not null, col1 int AUTO_INCREMENT, col2 varchar(255) not null, index(col2, id, col1))comment="sequoiadb:{ table_options: { ShardingKey: { id: 1 }, ShardingType: 'hash', AutoSplit:true } }";
insert into t1(id, col2) values(1, 'var1'), (2, 'var2'), (3, 'var3'), (4, 'var4'), (5, 'var5'), (6, 'var6'), (7, 'var7'), (8, 'var8'), (9, 'var9'), (10, 'var10');
show create table t1;
select * from t1 order by col1;
ALTER TABLE t1 DROP col1, algorithm = inplace;
show create table t1;
insert into t1(id, col2) values(11, 'var11');
select * from t1 order by id;
drop table t1;

#Case #19375
create table t2(id int AUTO_INCREMENT KEY);
create table t1(id int AUTO_INCREMENT KEY);
insert into t1() values(), (), (), (), (), (), (), (), (), ();
ALTER TABLE t1 ADD (col1 varchar(255) COMMENT 'string' COLLATE utf8_bin COLUMN_FORMAT FIXED STORAGE MEMORY,col2 int, foreign key (col2) references t2(id)), algorithm = inplace;
show create table t1;
insert into t1(col1, col2) values('string1', 100);
select * from t1 order by id;

#Case #19393
ALTER TABLE t1 DROP col1, algorithm = inplace;
ALTER TABLE t1 DROP col2, algorithm = inplace;
show create table t1;
insert into t1 values();
select * from t1 order by id;
drop table t1,t2;

#Case #19376
create table t1(id int AUTO_INCREMENT KEY);
insert into t1() values(), (), (), (), (), (), (), (), (), ();
ALTER TABLE t1 ADD (col1 int default 100),ADD CHECK (col1 <50), algorithm = inplace;
ALTER TABLE t1 ADD CHECK (id <100), algorithm = inplace;
show create table t1;
insert into t1 values();
select * from t1 order by id;
drop table t1;

#Case #19408
create table t1(id int AUTO_INCREMENT KEY);
insert into t1() values(), (), (), (), (), (), (), (), (), ();
-- error 1846
ALTER TABLE t1 ADD(col1 DATETIME not null DEFAULT CURRENT_TIMESTAMP), algorithm = inplace;
-- error 1846
ALTER TABLE t1 ADD(col1 TIMESTAMP not null DEFAULT CURRENT_TIMESTAMP), algorithm = inplace;
show create table t1;
select * from t1 order by id;
drop table t1;

#Case 19409 #Case 19410
create table t1(id int AUTO_INCREMENT KEY);
insert into t1() values(), (), (), (), (), (), (), (), (), ();
--error 1067
ALTER TABLE t1 ADD(col1 DATETIME DEFAULT 0), algorithm = inplace;
--error 1067
ALTER TABLE t1 ADD(col2 DATE DEFAULT 0), algorithm = inplace;
--error 1067
ALTER TABLE t1 ADD(col3 TIMESTAMP DEFAULT 0), algorithm = inplace;
--error 1292
ALTER TABLE t1 ADD(col1 DATETIME NOT NULL), algorithm = inplace;
--error 1292
ALTER TABLE t1 ADD(col2 DATETIME NOT NULL), algorithm = inplace;
--error 1292
ALTER TABLE t1 ADD(col3 DATETIME NOT NULL), algorithm = inplace;
show create table t1;
select * from t1 order by id;
drop table t1;

#Case #19394
create table t1(id int KEY, col1 int);
insert into t1 values(1,1),(2,2),(3,3),(4,4),(5,5),(6,6),(7,7),(8,8),(9,9),(10,10);
show create table t1;
select * from t1 order by id;
--error 40178
ALTER TABLE t1 DROP id, algorithm = inplace;
show create table t1;
select * from t1 order by id;
drop table t1;

#Case 19377
create table t1 ( id int auto_increment primary key, a tinyint default 1, b smallint default 1, c int default 1, d bigint default 1 );
insert into t1 values (),(),(),(),(),(),(),(),(),();
insert into t1(a,b,c,d) values (2,3,4,5), (6,7,8,9), (10,11,12,13);
insert into t1 values (),(),(),(),();
select * from t1 order by id;
alter table t1 change a a tinyint default -10, algorithm=inplace;
alter table t1 change b b smallint default -10, algorithm=inplace;
alter table t1 change c c int default -10, algorithm=inplace;
alter table t1 change d d bigint default -10, algorithm=inplace;
show create table t1;
insert into t1 values (),(),(),(),();
insert into t1(a,b,c,d) values (-10,-10,-10,-10), (1,1,1,1);
insert into t1 values ();
select * from t1 order by id;
alter table t1 modify a tinyint, algorithm=inplace;
alter table t1 modify b smallint, algorithm=inplace;
alter table t1 modify c int, algorithm=inplace;
alter table t1 modify d bigint, algorithm=inplace;
show create table t1;
insert into t1(a,b,c,d) values (-10,-10,-10,-10), (1,1,1,1);
insert into t1 values ();
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, a char(10) default 'a', b varchar(10) default 'a', c binary(8) default 'a', d varbinary(8) );
insert into t1 values (),(),(),(),(),(),(),(),(),();
insert into t1(a,b,c,d) values ('bcdef','bcdef','bcdef','bcdef'), ('opqrst','opqrst','opqrst','opqrst');
insert into t1 values (),(),(),(),();
select * from t1 order by id;
alter table t1 change a a char(10) default '#!*()', algorithm=inplace;
alter table t1 change b b varchar(10) default -1, algorithm=inplace;
alter table t1 change c c binary(8) default '#!*()', algorithm=inplace;
alter table t1 change d d varbinary(8) default -1, algorithm=inplace;
show create table t1;
insert into t1 values (),(),(),(),();
insert into t1(a,b,c,d) values ('#!*()', -1, '#!*()', -1), ('a', 'a', 'a', 'a');
insert into t1 values ();
select * from t1 order by id;
alter table t1 modify a char(10), algorithm=inplace;
alter table t1 modify b varchar(10), algorithm=inplace;
alter table t1 modify c binary(8), algorithm=inplace;
alter table t1 modify d varbinary(8), algorithm=inplace;
show create table t1;
insert into t1(a,b,c,d) values ('#!*()', -1, '#!*()', -1), ('a', 'a', 'a', 'a');
insert into t1 values ();
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, a float default 1.0001, b double default 1.0001, c decimal default 1.0001 );
insert into t1 values (),(),(),(),(),(),(),(),(),();
insert into t1(a,b,c) values (1e1, 1e1, 1e1), (123.23E+02, 123.23E+02, 123.23E+02);
insert into t1 values (),(),(),();
select * from t1 order by id;
alter table t1 change a a float default 6e-16, algorithm=inplace;
alter table t1 change b b double default 6e-16, algorithm=inplace;
alter table t1 change c c decimal default 6e-16, algorithm=inplace;
show create table t1;
insert into t1 values (),(),(),();
insert into t1(a,b,c) values (6e-16, 6e-16, 6e-16), (1.0001, 1.0001, 1.0001);
insert into t1 values ();
select * from t1 order by id;
alter table t1 modify a float, algorithm=inplace;
alter table t1 modify b double, algorithm=inplace;
alter table t1 modify c decimal, algorithm=inplace;
show create table t1;
insert into t1 values (),(),(),();
insert into t1(a,b,c) values (6e-16, 6e-16, 6e-16), (1.0001, 1.0001, 1.0001);
insert into t1 values ();
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, a year default 1999, b date default '2030-12-14', c time default '01:01:01', d datetime default CURRENT_TIMESTAMP, e timestamp default CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP);
insert into t1 values (),(),(),(),(),(),(),(),(),();
insert into t1(a,b,c,d,e) values(2000, "2002-03-04",'09:00:00','2003-03-01 00:00:00', "19990102030405"), (2001, "2002-03-05",'10:11:00','2004-04-01 00:00:00', "2004-12-31 23:59:59");
insert into t1 values (),(),(),();
--replace_column 5 x 6 x
select * from t1 order by id;
alter table t1 change a a year default 2056, algorithm=inplace;
alter table t1 change b b date default "2019-01-01", algorithm=inplace;
alter table t1 change c c time default '00:00:00', algorithm=inplace;
alter table t1 change d d datetime default '9999-12-31 00:00:00', algorithm=inplace;
alter table t1 change e e timestamp default "19990102030405", algorithm=inplace;
show create table t1;
insert into t1 values (),(),(),();
insert into t1(a,b,c,d,e) values(2000, "2002-03-04",'09:00:00','2003-03-01 00:00:00', "19990102030405"), (2001, "2002-03-05",'10:11:00','2004-04-01 00:00:00', "2004-12-31 23:59:59");
insert into t1 values ();
--replace_column 5 x 6 x 
select * from t1 order by id;
alter table t1 modify a year default 1999, algorithm=inplace;
alter table t1 modify d datetime default CURRENT_TIMESTAMP, algorithm=inplace;
alter table t1 modify e timestamp default CURRENT_TIMESTAMP, algorithm=inplace;
show create table t1;
insert into t1 values ();
--replace_column 5 x 6 x
select * from t1 order by id;
alter table t1 modify a year, algorithm=inplace;
alter table t1 modify b date, algorithm=inplace;
alter table t1 modify c time, algorithm=inplace;
alter table t1 modify d datetime, algorithm=inplace;
alter table t1 modify e timestamp, algorithm=inplace;
show create table t1;
insert into t1 values ();
insert into t1(a,b,c,d,e) values(2020, "2020-02-02",'10:00:00','2020-02-10 00:00:00', "19990102030405"), (2021, "2021-1-02",'10:11:00','2020-03-01 00:00:00', "2021-12-31 23:59:59");
--replace_column 5 x 6 x
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, a bit(8) default 1, b bool default false, c enum('a','c','d') default 'd', d set('a','b','c','d','e') default 'a,b,e');
insert into t1 values (),(),(),(),(),(),(),(),(),();
insert into t1(a,b,c,d) values (1, true, 'a', 'a,b'), (2, true, 'c', 'b,c'), (3, false, 'd', 'a,b,e');
insert into t1 values (),(),(),();
select * from t1 order by id;
alter table t1 change a a bit(8) default 7, algorithm=inplace;
alter table t1 change b b bool default false, algorithm=inplace;
alter table t1 change c c enum('a','c','d') default 'a', algorithm=inplace;
alter table t1 change d d set('a','b','c','d','e') default 'b,a,e', algorithm=inplace;
show create table t1;
insert into t1 values ();
insert into t1(a,b,c,d) values (1, false, 'a', 'b,c'), (7, true, 'c', 'b,a,e');
select * from t1 order by id;
alter table t1 modify a bit(8), algorithm=inplace;
alter table t1 modify b bool, algorithm=inplace;
alter table t1 modify c enum('a','c','d'), algorithm=inplace;
alter table t1 modify d set('a','b','c','d','e'), algorithm=inplace;
show create table t1;
insert into t1 values ();
insert into t1(a,b,c,d) values (1, false, 'a', 'b,c'), (7, true, 'c', 'b,a,e');
select * from t1 order by id;
drop table t1;

#Case 19378
create table t1 ( id int auto_increment primary key, a tinyint, b smallint, c int, d bigint );
insert into t1(a,b,c,d) values (2,2,2,2),(3,3,3,3), (5,5,5,5), (9,9,9,9), (4,4,4,4), (7,7,7,7), (10,10,10,10), (17,17,17,17),(21,21,21,21);
select * from t1 order by id;
alter table t1 change a a tinyint not null, algorithm=inplace;
alter table t1 change b b smallint not null, algorithm=inplace;
alter table t1 change c c int not null, algorithm=inplace;
alter table t1 change d d bigint not null, algorithm=inplace;
show create table t1;
insert into t1(a,b,c,d) values (-10,-10,-10,-10), (1,1,1,1);
select * from t1 order by id;
alter table t1 modify a tinyint, algorithm=inplace;
alter table t1 modify b smallint, algorithm=inplace;
alter table t1 modify c int, algorithm=inplace;
alter table t1 modify d bigint, algorithm=inplace;
show create table t1;
insert into t1(a,b,c,d) values (-10,-10,-10,-10), (1,1,1,1), (-101,-101,-101,-101);
insert into t1 values (),();
select * from t1 order by id;
#BUG SEQUOIASQLMAINSTREAM-398,
set sql_mode = "STRICT_TRANS_TABLES";
--error 1138
alter table t1 change a a tinyint not null;
#BUG SEQUOIASQLMAINSTREAM-398
set sql_mode = "STRICT_ALL_TABLES";
--error 1138
alter table t1 change a a tinyint not null;
select * from t1 order by id;
set sql_mode = default;
drop table t1;

#Case 20207
--disable_warnings
set sql_mode = "STRICT_ALL_TABLES";
--enable_warnings
create table t1(id int auto_increment primary key, a bigint, b char(255), c varchar(255));
alter table t1 modify a mediumint not null,algorithm=inplace;
insert into t1(a,b,c) values(1,'a','a');
alter table t1 modify b char(100) not null,algorithm=inplace;
insert into t1(a,b,c) values(1,'a','aaaaa'),(1,'a',null);
--error 1138
alter table t1 modify c varchar(5) not null,algorithm=inplace;
select * from t1 order by id;

#Case 20208
--disable_warnings
set sql_mode= "";
--enable_warnings
alter table t1 modify c varchar(255) not null,algorithm=inplace;
select * from t1 order by id;

drop table t1;
--disable_warnings
set sql_mode = default;
--enable_warnings

create table t1 ( id int auto_increment primary key, a char(10), b varchar(10), c binary(8), d varbinary(8) );
insert into t1(a,b,c,d) values ('bcdef','bcdef','bcdef','bcdef'),('opqrst','opqrst','opqrst','opqrst'), ('xyo', 'xyo', 'xyo', 'xyo'), ('bibubibu', 'bibubibu','bibubibu', 'bibubibu'), ('aaa', 'aaa', 'aaa', 'aaa'), ('ccc', 'ccc', 'ccc', 'ccc');
select * from t1 order by id;
alter table t1 change a a char(10) not null, algorithm=inplace;
alter table t1 change b b varchar(10) not null, algorithm=inplace;
alter table t1 change c c binary(8) not null, algorithm=inplace;
alter table t1 change d d varbinary(8) not null, algorithm=inplace;
show create table t1;
insert into t1(a,b,c,d) values ('a', 'a', 'a', 'a'),('b', 'b', 'b', 'b'),('c', 'c', 'c', 'c'), ('#!*()', -1, '#!*()', -1);
select * from t1 order by id;
alter table t1 modify a char(10), algorithm=inplace;
alter table t1 modify b varchar(10), algorithm=inplace;
alter table t1 modify c binary(8), algorithm=inplace;
alter table t1 modify d varbinary(8), algorithm=inplace;
show create table t1;
insert into t1(a,b,c,d) values ('#!*()', -1, '#!*()', -1), (NULL,NULL,NULL,NULL), ('a', 'a', 'a', 'a');
insert into t1 values ();
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, a tinytext, b mediumtext, c text, d longtext );
insert into t1(a,b,c,d) values ('bcdef','bcdef','bcdef','bcdef'), ('opqrst','opqrst','opqrst','opqrst'), ('xyo', 'xyo', 'xyo', 'xyo'), ('bibubibu', 'bibubibu','bibubibu', 'bibubibu'), ('aaa', 'aaa', 'aaa', 'aaa'), ('ccc', 'ccc', 'ccc', 'ccc');
select * from t1 order by id;
alter table t1 change a a tinytext not null, algorithm=inplace;
alter table t1 change b b mediumtext not null, algorithm=inplace;
alter table t1 change c c text not null, algorithm=inplace;
alter table t1 change d d longtext not null, algorithm=inplace;
show create table t1;
insert into t1(a,b,c,d) values ('a', 'a', 'a', 'a'),('b', 'b', 'b', 'b'),('c', 'c', 'c', 'c'), ('#!*()', -1, '#!*()', -1);
select * from t1 order by id;
alter table t1 modify a tinytext, algorithm=inplace;
alter table t1 modify b mediumtext, algorithm=inplace;
alter table t1 modify c text, algorithm=inplace;
alter table t1 modify d longtext, algorithm=inplace;
show create table t1;
insert into t1(a,b,c,d) values ('#!*()', -1, '#!*()', -1), (NULL,NULL,NULL,NULL), ('a', 'a', 'a', 'a');
insert into t1 values ();
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, a tinyblob, b mediumblob, c blob, d longblob );
insert into t1(a,b,c,d) values ('bcdef','bcdef','bcdef','bcdef'), ('opqrst','opqrst','opqrst','opqrst'), ('xyo', 'xyo', 'xyo', 'xyo'), ('bibubibu', 'bibubibu','bibubibu', 'bibubibu'), ('aaa', 'aaa', 'aaa', 'aaa'), ('ccc', 'ccc', 'ccc', 'ccc');
select * from t1 order by id;
alter table t1 change a a tinyblob not null, algorithm=inplace;
alter table t1 change b b mediumblob not null, algorithm=inplace;
alter table t1 change c c blob not null, algorithm=inplace;
alter table t1 change d d longblob not null, algorithm=inplace;
show create table t1;
insert into t1(a,b,c,d) values ('a', 'a', 'a', 'a'),('b', 'b', 'b', 'b'),('c', 'c', 'c', 'c'), ('#!*()', -1, '#!*()', -1);
select * from t1 order by id;
alter table t1 modify a tinyblob, algorithm=inplace;
alter table t1 modify b mediumblob, algorithm=inplace;
alter table t1 modify c blob, algorithm=inplace;
alter table t1 modify d longblob, algorithm=inplace;
show create table t1;
insert into t1(a,b,c,d) values ('#!*()', -1, '#!*()', -1), (NULL,NULL,NULL,NULL), ('a', 'a', 'a', 'a');
insert into t1 values ();
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, a float, b double, c decimal );
insert into t1(a,b,c) values (1e1, 1e1, 1e1),(123.23E+02, 123.23E+02, 123.23E+02),(2e2, 2e2, 2e2),(123.333,123.333,123.333),(8E+01,8E+01,8E+01);
select * from t1 order by id;
alter table t1 change a a float not null, algorithm=inplace;
alter table t1 change b b double not null, algorithm=inplace;
alter table t1 change c c decimal not null, algorithm=inplace;
show create table t1;
insert into t1(a,b,c) values (6e-16, 6e-16, 6e-16), (1.0001, 1.0001, 1.0001);
select * from t1 order by id;
alter table t1 modify a float, algorithm=inplace;
alter table t1 modify b double, algorithm=inplace;
alter table t1 modify c decimal, algorithm=inplace;
show create table t1;
insert into t1(a,b,c) values (6e-16, 6e-16, 6e-16), (NULL,NULL,NULL), (1.0001, 1.0001, 1.0001);
insert into t1 values ();
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, a year, b date, c time, d datetime, e timestamp);
insert into t1(a,b,c,d,e) values (2000, "2002-03-04",'09:00:00','2003-03-01 00:00:00', "19990102030405"), (2001, "2002-03-05",'10:11:00','2004-04-01 00:00:00', "2004-12-31 23:59:59"), (2002, current_date, current_time, current_timestamp, current_timestamp), (1999, "2019-01-10",'10:10:10','2019-01-11 00:00:00', "19990102030407"),(1998, "2012-05-10",'11:11:11','2012-04-01 00:00:00',"2012-04-01 00:00:00"), (2020, "2020-12-10",'11:11:11','2030-11-01 00:00:00',"2020-04-01 23:59:59");
alter table t1 change a a year not null, algorithm=inplace;
# when sql_mode=NO_ZERO_DATE,NO_ZERO_IN_DATE, date and datetime cannot convert null to not null
#alter table t1 change b b date not null, algorithm=inplace;
alter table t1 change c c time not null, algorithm=inplace;
#alter table t1 change d d datetime not null, algorithm=inplace;
alter table t1 change e e timestamp not null, algorithm=inplace;
show create table t1;
insert into t1(a,b,c,d,e) values(2000, "2002-03-04",'09:00:00','2003-03-01 00:00:00', "19990102030405"), (2001, "2002-03-05",'10:11:00','2004-04-01 00:00:00', "2004-12-31 23:59:59");
alter table t1 modify a year, algorithm=inplace;
alter table t1 modify b date, algorithm=inplace;
alter table t1 modify c time, algorithm=inplace;
alter table t1 modify d datetime default CURRENT_TIMESTAMP, algorithm=inplace;
alter table t1 modify e timestamp default CURRENT_TIMESTAMP, algorithm=inplace;
insert into t1 values ();
alter table t1 modify a year, algorithm=inplace;
alter table t1 modify b date, algorithm=inplace;
alter table t1 modify c time, algorithm=inplace;
alter table t1 modify d datetime, algorithm=inplace;
alter table t1 modify e timestamp, algorithm=inplace;
show create table t1;
insert into t1(a,b,c,d,e) values(2020, "2020-02-02",'10:00:00','2020-02-10 00:00:00', "19990102030405"), (NULL,NULL,NULL,NULL,NULL), (2021, "2021-1-02",'10:11:00','2020-03-01 00:00:00', "2021-12-31 23:59:59");
drop table t1;

create table t1 ( id int auto_increment primary key, a bit(8), b bool, c enum('a','c','d'), d set('a','b','c','d','e'));
insert into t1(a,b,c,d) values (1, true, 'a', 'a,b'), (2, true, 'c', 'b,c'), (3, false, 'd', 'a,b,e'), (6, false, 'c', 'a,e'), (5, false, 'a', 'b,c'), (4, true, 'c', 'd' );
select * from t1 order by id;
alter table t1 change a a bit(8) not null, algorithm=inplace;
alter table t1 change b b bool not null, algorithm=inplace;
alter table t1 change c c enum('a','c','d') not null, algorithm=inplace;
alter table t1 change d d set('a','b','c','d','e') not null, algorithm=inplace;
show create table t1;
insert into t1(a,b,c,d) values (1, false, 'a', 'b,c'), (7, true, 'c', 'b,a,e');
select * from t1 order by id;
alter table t1 modify a bit(8), algorithm=inplace;
alter table t1 modify b bool, algorithm=inplace;
alter table t1 modify c enum('a','c','d'), algorithm=inplace;
alter table t1 modify d set('a','b','c','d','e'), algorithm=inplace;
show create table t1;
insert into t1(a,b,c,d) values (1, false, 'a', 'b,c'), (7, true, 'c', 'b,a,e');
insert into t1 values (),();
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, a json );
insert into t1(a) values ('{"a": 2}'), ('[1,2]'), ('{"a":"b", "c":"d","ab":"abc", "bc": ["x", "y"]}'), ('["here", ["I", "am"], "!!!"]'),('"scalar string"'),('123456');
select * from t1 order by id;
alter table t1 change a a json not null, algorithm=inplace;
show create table t1;
insert into t1(a) values ('-32768'),('2147483647'),('18446744073709551616');
select * from t1 order by id;
alter table t1 change a a json, algorithm=inplace;
show create table t1;
insert into t1(a) values (NULL), ('"scalar string"');
insert into t1 values ();
select * from t1 order by id;
drop table t1;

#Case 19379 #Case 19380
#BUG #SEQUOIASQLMAINSTREAM-434
#create table t1 ( a tinyint, b smallint, c int, d bigint, primary key(a), unique key (b), key(c,d) );
#insert into t1 values (1,1,1,1),(3,3,3,3),(7,7,7,7),(10,10,10,10),(2,2,2,2),(8,8,8,8),(13,13,13,13),(20,20,20,20),(16,16,16,16),(17,17,17,17);
#alter table t1 change a a tinyint auto_increment, algorithm=inplace;
#show create table t1; 
#insert into t1(b,c,d) values (9,9,9), (21,21,21), (5,5,5);
#select * from t1 order by a;
#alter table t1 change a a tinyint, algorithm=inplace;
#insert into t1 values (25,25,25,25);
#alter table t1 change b b smallint auto_increment, algorithm=inplace;
#show create table t1; 
#insert into t1(a,c,d) values (30,30,30), (35,35,35);
#select * from t1 order by a;
#alter table t1 change b b smallint, algorithm=inplace;
#show create table t1; 
#insert into t1 values (32,32,32,32);
#select * from t1 order by a;
#alter table t1 change c c int auto_increment, algorithm=inplace;
#show create table t1; 
#insert into t1(a,b,d) values (40,40,40), (45,45,45);
#select * from t1 order by a;
#drop table t1; 

#Case 19381
create table t1 ( a bigint primary key, b float unique key storage disk, c char(16) column_format dynamic, d text charset gbk, e binary comment "I am binary")COMMENT='sequoiadb:{ auto_partition: false }';
create table t2 ( id int primary key, a bigint, b float, foreign key(a) references t1(a) match full on delete RESTRICT );
show create table t1; 
show create table t2; 
insert into t1 values (1,123.456,'abc','abc','a'), (10,12495.495,'aaa','aaa','1'),(55,539.32,'123','123','c'),(21,10.34,'Boe','Boe','A'),(0,348.39,'bbb','bbb','t'), (16,439.543, '43ls', '43ls', 'r');
insert into t2 values (1, 1, 123.456), (10, 10, 12495.495), (55, 55, 539.32), (21, 21, 10.34),(0, 0, 348.39), (16, 16, 439.543);
select * from t1 order by a;
select * from t2 order by id; 
alter table t2 drop foreign key t2_ibfk_1, algorithm = inplace;
alter table t2 add foreign key (b) references t1(b) match PARTIAL on UPDATE CASCADE, algorithm = inplace;
#BUG #SEQUOIASQLMAINSTREAM-408
alter table t1 change b b float, algorithm = inplace;
alter table t1 change c c char(16) character set gbk column_format fixed comment "I am char", algorithm = inplace;
alter table t1 change d d text character set utf8 collate utf8_bin, algorithm = inplace;
alter table t1 modify e binary, algorithm = inplace;
#BUG #SEQUOIASQLMAINSTREAM-408
alter table t2 modify id int storage memory, algorithm = inplace;
show create table t1;
show create table t2;
insert into t1 values (-12,23.3,'43kd','43kd','0'), (-3,543.543,'gfd8','gfd8','1'),(-1,30.32,'kgf9','kgf9','2');
insert into t2 values (5, 5, 23.3), (2, 2, 543.543), (-19, -19, 30.32);
select * from t1 order by a;
select * from t2 order by id; 
drop table t2,t1;

#Case 19382
create table t1 ( a int primary key, b bigint, c char(16) );
show create table t1; 
insert into t1 values (1, 1, 'a'), (10, 10, '1'), (-1, -1, '2d'), (8, 8, '4c'), (101, 101, 'BaC'), (2, 2, 'gkdel');
select * from t1 order by a; 
alter table t1 change a a int after b, algorithm = inplace;
alter table t1 modify c char(16) first, algorithm = inplace;
show create table t1; 
insert into t1 values ('o', 3, 3), ('p', -8, -8), ('A', 5, 5); 
select * from t1 order by a;
drop table t1;

#Case 19395
create table t1 ( id int primary key, name char(8) );
show create table t1; 
insert into t1 values (1,'a'), (-1,'b'), (10, '12'), (0, 'Ab'), (1001, 'Test'), (103, 'hello');
#BUG #SEQUOIASQLMAINSTREAM-412
alter table t1 force, algorithm = inplace;
show create table t1; 
insert into t1 values (4,'1'), (2,'0');
select * from t1 order by id; 
drop table t1;

#Case 19397 #Case 19398
create table t1 ( id int auto_increment primary key, a enum('b','a','z'), b set('1', 'a', 'c', '2', 'k', 'y', 'x') );
insert into t1(a,b) values ('a','k,y'), ('b', '1,2,x'), ('z', 'k,c'), ('b', 'k,y,2,a'), ('a', 'x,y'), ('z', 'a,x,k,1');
#BUG #SEQUOIASQLMAINSTREAM-413
--error 1846
alter table t1 change a a enum('1','a'), algorithm=inplace;
--error 1846
alter table t1 change a a enum('b'), algorithm=inplace;
show create table t1; 
--error 1846
alter table t1 change a a enum('b','c','z'), algorithm = inplace;
show create table t1; 
--error 1846
alter table t1 change a a enum('1','b','c','z'), algorithm = inplace;
show create table t1; 
#BUG #SEQUOIASQLMAINSTREAM-413
--error 1846
alter table t1 change b b set('1','a','c','k'), algorithm = inplace;
show create table t1; 
--error 1846
alter table t1 change b b set('0', '1', 'a', 'c', '2', 'k', 'y', 'x'), algorithm = inplace;
show create table t1; 
alter table t1 change a a enum('b','a','z','x','1','c'), algorithm = inplace;
alter table t1 change b b set('1', 'a', 'c', '2', 'k', 'y', 'x','m','n','0'), algorithm = inplace;
show create table t1; 
insert into t1(a,b) values ('a', 'x,y'), ('x', '1,a'), ('1', 'c,k'), ('c', 'y,2'), ('1', '1,a,x,m,0'), ('c', 'k,y,x,m,n,0');
select * from t1 order by id;
drop table t1; 

#Case 19407
create table t1 ( id smallint auto_increment primary key , a int unique key, b char(16) ) auto_increment=11 COMMENT='sequoiadb:{ auto_partition: false }';
insert into t1(a,b) values (18,'rejow'),(5,'rjle'),(1,'fj39'),(20,'gt'),(99,'uitreo'), (30,'1234');
show create table t1;                                                                  
select * from t1 order by id; 
#BUG #SEQUOIASQLMAINSTREAM-414
alter table t1 auto_increment=20, algorithm=inplace;
show create table t1;
insert into t1(a,b) values (101, '2323o'), (98, 'r43of'), (-2, '-bgfd42il');
select * from t1;
--error 40006
alter table t1 auto_increment=1000000, algorithm=inplace;
show create table t1; 
#BUG #SEQUOIASQLMAINSTREAM-414
alter table t1 auto_increment=30, algorithm=copy;
show create table t1;
insert into t1(a,b) values (-543, 'heo'), (53, 'te'), (9, '!2*rlw');
select * from t1 order by id;
drop table t1;

#Case 19403
create table t1 ( id tinyint primary key );
insert into t1 values (1), (-1), (0), (8), (18), (101), (22), (127), (-128);
alter table t1 change id id smallint, algorithm=inplace;
show create table t1;
insert into t1 values (-32768), (32767);
select * from t1 order by id;
alter table t1 change id id mediumint, algorithm=inplace;
show create table t1;
insert into t1 values (8388607), (-8388608);
select * from t1 order by id;
alter table t1 change id id int, algorithm=inplace;
show create table t1; 
insert into t1 values (-2147483648), (2147483647);
select * from t1 order by id;
alter table t1 change id id bigint, algorithm=inplace;
show create table t1;
insert into t1 values (9223372036854775807), (-9223372036854775808);
select * from t1 order by id;
drop table t1;

create table t1 ( id tinyint primary key, i1 tinyint, i2 tinyint, s1 smallint, s2 smallint, s3 smallint );
insert into t1 values (1,1,1,1,1,1), (-1,-1,-1,-1,-1,-1), (0,0,0,0,0,0), (8,8,8,8,8,8), (18,18,18,18,18,18), (101,101,101,101,101,101), (22,22,22,22,22,22), (127,127,127,32767,32767,32767), (-128,-128,-128,-32768,-32768,-32768);
alter table t1 change id id float(4,1), algorithm=inplace; 
alter table t1 modify i1 double, algorithm=inplace;
alter table t1 modify i2 decimal(6,3), algorithm=inplace;
alter table t1 change s1 s1 float(7,2), algorithm=inplace;
alter table t1 modify s2 double, algorithm=inplace; 
alter table t1 modify s3 decimal(5,0), algorithm=inplace;
show create table t1;
insert into t1 values (1.1000000000000001,1.1000000000000001,1.1000000000000001,1.1000000000000001,1.1000000000000001,1.1000000000000001),(10.48,10.48E+03,10.48,10.48,10.48E+03,10.48E+03); 
select * from t1 order by id;
drop table t1;

create table t1 ( id mediumint primary key, m1 mediumint, m2 mediumint, b1 bigint, b2 bigint, b3 bigint );
insert into t1 values (1,1,1,1,1,1), (-1,-1,-1,-1,-1,-1), (0,0,0,0,0,0), (8,8,8,8,8,8), (18,18,18,18,18,18), (101,101,101,101,101,101), (22,22,22,22,22,22),(8388607,8388607,8388607,9223372036854775807,9223372036854775807,9223372036854775807), (-8388608,-8388608,-8388608,-9223372036854775808,-9223372036854775808,-9223372036854775808);
#BUG #SEQUOIASQLMAINSTREAM-417
--error 1846 
alter table t1 change id id float(9,1), algorithm=inplace;
alter table t1 modify m1 double, algorithm=inplace;
alter table t1 modify m2 decimal, algorithm=inplace;
#BUG #SEQUOIASQLMAINSTREAM-417
--error 1846
alter table t1 change b1 b1 float(53,20), algorithm=inplace;
--error 1846
alter table t1 modify b2 double(21,2), algorithm=inplace;
alter table t1 modify b3 decimal(52,30), algorithm=inplace;
show create table t1;
insert into t1 values (5830,5830,5830,85039430942,85039430942,85039430942), (-683904,-683904,-683904,-5792293719,-5792293719,-5792293719);
select * from t1 order by id; 
drop table t1;

create table t1 ( id int primary key, i1 int, i2 int );
insert into t1 values (1,1,1),(-1,-1,-1),(0,0,0),(8,8,8),(18,18,18),(101,101,101),(22,22,22),(-2147483648,-2147483648,-2147483648),(2147483647,2147483647,2147483647);
#BUG #SEQUOIASQLMAINSTREAM-417
--error 1846
alter table t1 change id id float(12,1), algorithm=inplace;
alter table t1 modify i1 double, algorithm=inplace;
alter table t1 modify i2 decimal(11,1), algorithm=inplace;
show create table t1;
insert into t1 values (5830,5830,5830),(85039430,85039430,85039430),(-683904,-683904,-683904),(-57922937,-57922937,-57922937);
select * from t1 order by id;
drop table t1;

create table t1 ( id float primary key, f1 float(24,2), f2 float(11,2), f3 float(2,0), f4 float(3,0), f5 float(4,0), f6 float(5,0), f7 float(6,0), f8 float(7,0), f9 float(9,0), f10 float(10,0), f11 float(18,0), f12 float(19,0) );
insert into t1 values (-3.402823466E+38,-3402823466.0,-34028235.01,9,9,9,9,9,9,9,9,9,9);
insert into t1 values (0.1111111,0.1111111,0.1111111,10,101,101,101,101,101,101,101,101,101);
insert into t1 values (1234.56789,1234.56789,1234.56789,11,111,111,111,111,111,111,111,111,111);
insert into t1 values (-1.175494351E-38,-117549435.0,-117549435.01,99,99,99,99,99,99,99,99,99,99);
insert into t1 values (3.402823466351E+38, 3402823466.0, 34028267.35,1,1,1,1,1,1,1,1,1,1);
insert into t1 values (68940E+30, 4823348320.2, 3180553.12,0,0,0,0,0,0,0,0,0,0);
#BUG #SEQUOIASQLMAINSTREAM-419
--error 1846
alter table t1 modify f1 float(24,3), algorithm=inplace;
alter table t1 modify f1 float(26,3), algorithm=inplace;
#BUG #SEQUOIASQLMAINSTREAM-420
alter table t1 modify f2 decimal(20,2), algorithm=inplace;
#BUG #SEQUOIASQLMAINSTREAM-424
--error 1846
alter table t1 change f3 f3 bit(8), algorithm=inplace;
--error 1846
alter table t1 change f4 f4 tinyint, algorithm=inplace;
--error 1846               
alter table t1 change f6 f6 smallint, algorithm=inplace;
--error 1846             
alter table t1 change f8 f8 mediumint, algorithm=inplace;
--error 1846                 
alter table t1 change f10 f10 int, algorithm=inplace;
--error 1846                 
alter table t1 change f12 f12 bigint, algorithm=inplace;
alter table t1 change f3 f3 tinyint, algorithm=inplace;
alter table t1 change f5 f5 smallint, algorithm=inplace;
alter table t1 change f7 f7 mediumint, algorithm=inplace;
alter table t1 change f9 f9 int, algorithm=inplace;
alter table t1 change f11 f11 bigint, algorithm=inplace;
alter table t1 change id id double, algorithm=inplace;
show create table t1;
insert into t1 values (5793842.23, 84209402834.45, 4820840.10,6,6,6,6,6,6,6,6,6,6);
select * from t1 order by id;
drop table t1;

create table t1 ( id double primary key, d1 double(24,2), d2 double(11,2), d3 double(2,0), d4 double(3,0), d5 double(4,0), d6 double(5,0), d7 double(6,0), d8 double(7,0), d9 double(9,0), d10 double(10,0), d11 double(18,0), d12 double(19,0) );
insert into t1 values (-1.7976931348623157E+308,-340288493249223466.21,-34028235.01,9,9,9,9,9,9,9,9,9,9);
insert into t1 values (0.1111111111111,0.111111111111111,0.1111111,10,101,101,101,101,101,101,101,101,101);
insert into t1 values (12344321.56789,12344321.56789,1234.56789,11,111,111,111,111,111,111,111,111,111);
insert into t1 values (-2.2250738585072014E-308,-117549749202435.30, -117549435.01,99,99,99,99,99,99,99,99,99,99);
insert into t1 values (1.7976931348623157E+308, 34028234684593436.99, 34028267.35,1,1,1,1,1,1,1,1,1,1);
insert into t1 values (3849238024892.123, 15493749234289.1, 42934729.9,0,0,0,0,0,0,0,0,0,0);
#BUG #SEQUOIASQLMAINSTREAM-419
--error 1846
alter table t1 modify d1 double(24,3), algorithm=inplace;
alter table t1 modify d1 double(26,3), algorithm=inplace;
#BUG #SEQUOIASQLMAINSTREAM-420
alter table t1 modify d2 decimal(20,2), algorithm=inplace;     
#BUG #SEQUOIASQLMAINSTREAM-424
--error 1846
alter table t1 change d3 d3 bit(8), algorithm=inplace;
--error 1846
alter table t1 change d4 d4 tinyint, algorithm=inplace;
--error 1846               
alter table t1 change d6 d6 smallint, algorithm=inplace;
--error 1846             
alter table t1 change d8 d8 mediumint, algorithm=inplace;
--error 1846                 
alter table t1 change d10 d10 int, algorithm=inplace;
--error 1846                 
alter table t1 change d12 d12 bigint, algorithm=inplace;
alter table t1 change d3 d3 tinyint, algorithm=inplace;
alter table t1 change d5 d5 smallint, algorithm=inplace;
alter table t1 change d7 d7 mediumint, algorithm=inplace;
alter table t1 change d9 d9 int, algorithm=inplace;
alter table t1 change d11 d11 bigint, algorithm=inplace;
show create table t1;
insert into t1 values (5793842.23, 84209402834.45, 4820840.10,6,6,6,6,6,6,6,6,6,6);
select * from t1 order by id;
drop table t1;

create table t1 ( id decimal primary key, d1 decimal(24,2), d3 decimal(2,0), d4 decimal(3,0), d5 decimal(4,0), d6 decimal(5,0), d7 decimal(6,0), d8 decimal(7,0), d9 decimal(9,0), d10 decimal, d11 decimal(18,0), d12 decimal(19,0) );
insert into t1 values (-34028235,-340288493249223466.21,9,9,9,9,9,9,9,9,9,9);
insert into t1 values (111111111,1111111111.11,10,101,101,101,101,101,101,101,101,101);
insert into t1 values (12344321, 2250738585734.22,11,111,111,111,111,111,111,111,111,111);
insert into t1 values (-117549435, 7976931348623157.12,99,99,99,99,99,99,99,99,99,99);
insert into t1 values (56789, 56789.4321,1,1,1,1,1,1,1,1,1,1);
insert into t1 values (4293749, 8549374927933329.2,0,0,0,0,0,0,0,0,0,0);
#BUG #SEQUOIASQLMAINSTREAM-419
--error 1846
alter table t1 modify d1 decimal(24,3), algorithm=inplace;
alter table t1 change d1 d1 decimal(27,3), algorithm=inplace;
#BUG #SEQUOIASQLMAINSTREAM-424
--error 1846
alter table t1 change d3 d3 bit(8), algorithm=inplace;
--error 1846
alter table t1 change d4 d4 tinyint, algorithm=inplace;
--error 1846               
alter table t1 change d6 d6 smallint, algorithm=inplace;
--error 1846             
alter table t1 change d8 d8 mediumint, algorithm=inplace;
--error 1846                 
alter table t1 change d10 d10 int, algorithm=inplace;
--error 1846                 
alter table t1 change d12 d12 bigint, algorithm=inplace;
alter table t1 change d3 d3 tinyint, algorithm=inplace;
alter table t1 change d5 d5 smallint, algorithm=inplace;
alter table t1 change d7 d7 mediumint, algorithm=inplace;
alter table t1 change d9 d9 int, algorithm=inplace;
alter table t1 change d11 d11 bigint, algorithm=inplace;
show create table t1;
insert into t1 values (5793842, 584308008420940283456734.45,6,6,6,6,6,6,6,6,6,6);
select * from t1 order by id;
drop table t1;

create table t1 ( id bit(8) primary key );
insert into t1 values (b'11111111'), (b'10000001'), (b'100001'),(b'10101010'),(b'0000000'),(b'1');
alter table t1 change id id bit(16), algorithm=inplace;
show create table t1;
insert into t1 values (b'1111111111111111'), (b'10101010101010');
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, a enum('b','a','z'), b set('1', 'a', 'c', '2', 'k', 'y', 'x') );
insert into t1(a,b) values ('a','k,y'), ('b', '1,2,x'), ('z', 'k,c'), ('b', 'k,y,2,a'), ('a', 'x,y'), ('z', 'a,x,k,1');
alter table t1 change a a enum('b','a','z','x','1','c'), algorithm = inplace;
alter table t1 change b b set('1', 'a', 'c', '2', 'k', 'y', 'x','m','n','0'), algorithm = inplace;
show create table t1; 
insert into t1(a,b) values ('a', 'x,y'), ('x', '1,a'), ('1', 'c,k'), ('c', 'y,2'), ('1', '1,a,x,m,0'), ('c', 'k,y,x,m,n,0');
select * from t1 order by id; 
drop table t1;

create table t1 ( id tinyint unsigned primary key, i1 tinyint unsigned, i2 tinyint unsigned, i3 tinyint unsigned, i4 tinyint unsigned, i5 tinyint unsigned);
insert into t1 values (109,109,109,109,109,109),(1,1,1,1,1,1),(20,20,20,20,20,20),(127,127,127,127,127,127),(0,0,0,0,0,0),(255,255,255,255,255,255);
alter table t1 change id id bit(8), algorithm=inplace;
alter table t1 change i1 i1 tinyint unsigned, algorithm=inplace;
alter table t1 change i2 i2 smallint unsigned, algorithm=inplace;
alter table t1 change i3 i3 mediumint unsigned, algorithm=inplace;
alter table t1 change i4 i4 int unsigned, algorithm=inplace;
alter table t1 change i5 i5 bigint unsigned, algorithm=inplace;
show create table t1;
insert into t1 values (b'10101010',254,65535,16777215,4294967295,4294967295), (b'1001',253,65534,16777214,4294967294,4294967294);
select * from t1 order by id;
drop table t1;

create table t1 ( id tinyint unsigned primary key, i1 tinyint unsigned );
insert into t1 values (109,109),(1,1),(20,20),(127,127),(0,0),(255,255);
alter table t1 modify id enum('a1','a2','a3','a4','a5','a6','a7','a8','a9','a10','a11','a12','a13','a14','a15','a16','a17','a18','a19','a20','a21','a22','a23','a24','a25','a26','a27','a28','a29','a30','a31','a32','a33','a34','a35','a36','a37','a38','a39','a40','a41','a42','a43','a44','a45','a46','a47','a48','a49','a50','a51','a52','a53','a54','a55','a56','a57','a58','a59','a60','a61','a62','a63','a64','a65','a66','a67','a68','a69','a70','a71','a72','a73','a74','a75','a76','a77','a78','a79','a80','a81','a82','a83','a84','a85','a86','a87','a88','a89','a90','a91','a92','a93','a94','a95','a96','a97','a98','a99','a100','a101','a102','a103','a104','a105','a106','a107','a108','a109','a110','a111','a112','a113','a114','a115','a116','a117','a118','a119','a120','a121','a122','a123','a124','a125','a126','a127','a128','b1','b2','b3','b4','b5','b6','b7','b8','b9','b10','b11','b12','b13','b14','b15','b16','b17','b18','b19','b20','b21','b22','b23','b24','b25','b26','b27','b28','b29','b30','b31','b32','b33','b34','b35','b36','b37','b38','b39','b40','b41','b42','b43','b44','b45','b46','b47','b48','b49','b50','b51','b52','b53','b54','b55','b56','b57','b58','b59','b60','b61','b62','b63','b64','b65','b66','b67','b68','b69','b70','b71','b72','b73','b74','b75','b76','b77','b78','b79','b80','b81','b82','b83','b84','b85','b86','b87','b88','b89','b90','b91','b92','b93','b94','b95','b96','b97','b98','b99','b100','b101','b102','b103','b104','b105','b106','b107','b108','b109','b110','b111','b112','b113','b114','b115','b116','b117','b118','b119','b120','b121','b122','b123','b124','b125','b126','b127','b128'), algorithm=inplace;
alter table t1 modify i1 set('a1','a2','a3','a4','a5','a6','a7','a8'), algorithm=inplace;
show create table t1;
insert into t1 values ('b23', 'a1,a2');
select * from t1 order by id;
drop table t1;

create table t1 ( id tinyint unsigned primary key, i1 tinyint unsigned, i2 tinyint unsigned );
insert into t1 values (109,109,109),(1,1,1),(20,20,20),(127,127,127),(0,0,0),(255,255,255);
alter table t1 change id id float(4,1) unsigned, algorithm=inplace;
alter table t1 modify i1 double unsigned, algorithm=inplace;
alter table t1 modify i2 decimal(6,3) unsigned, algorithm=inplace;
show create table t1;
insert into t1 values (1.1000000000000001,1.1000000000000001,1.1000000000000001),(10.48,10.48E+03,10.48);
select * from t1 order by id;
alter table t1 change id id float(4,1), algorithm=inplace;
alter table t1 modify i1 double, algorithm=inplace;
alter table t1 modify i2 decimal(6,3), algorithm=inplace;
show create table t1;
insert into t1 values (-1.1000000000000001,-1.1000000000000001,-1.1000000000000001),(-10.48,-10.48E+03,-10.48);
select * from t1 order by id;
drop table t1;

create table t1 ( id smallint unsigned primary key, i1 smallint unsigned, i2 smallint unsigned, i3 smallint unsigned, i4 smallint unsigned);
insert into t1 values (109,109,109,109,109),(1,1,1,1,1),(20,20,20,20,20),(32768,32768,32768,32768,32768),(0,0,0,0,0),(65535,65535,65535,65535,65535);
alter table t1 change id id bit(16), algorithm=inplace;
alter table t1 change i1 i1 smallint unsigned, algorithm=inplace;
alter table t1 change i2 i2 mediumint unsigned, algorithm=inplace;
alter table t1 change i3 i3 int unsigned, algorithm=inplace;
alter table t1 change i4 i4 bigint unsigned, algorithm=inplace;
show create table t1;
insert into t1 values (b'1010101010101010',65534,16777215,4294967295,18446744073709551615), (b'100110011',65533,16777214,4294967294,18446744073709551614);
select * from t1 order by id;
drop table t1;

create table t1 ( id smallint unsigned primary key, i1 smallint unsigned );
insert into t1 values (109,109),(1,1),(20,20),(32768,32768),(0,0),(65535,65535);
alter table t1 modify i1 set('a1','a2','a3','a4','a5','a6','a7','a8','a9','a10','a11', 'a12', 'a13', 'a14', 'a15', 'a16'), algorithm=inplace;
show create table t1;
insert into t1 values (110, 'a1,a2');
select * from t1 order by id;
drop table t1;

create table t1 ( id smallint unsigned primary key, i1 smallint unsigned, i2 smallint unsigned );
insert into t1 values (109,109,109),(1,1,1),(20,20,20),(32768,32768,32768),(0,0,0),(65535,65535,65535);
alter table t1 change id id float(6,1) unsigned, algorithm=inplace;
alter table t1 modify i1 double unsigned, algorithm=inplace;
alter table t1 modify i2 decimal(10,3) unsigned, algorithm=inplace;
show create table t1;
insert into t1 values (1.1000000000000001,1.1000000000000001,1.1000000000000001),(10.48,10.48E+03,10.48);
select * from t1 order by id;
alter table t1 change id id float(7,1), algorithm=inplace;
alter table t1 modify i1 double, algorithm=inplace;
alter table t1 modify i2 decimal(12,3), algorithm=inplace;
show create table t1;
insert into t1 values (-1.1000000000000001,-1.1000000000000001,-1.1000000000000001),(-10.48,-10.48E+03,-10.48);
select * from t1 order by id;
drop table t1;

create table t1 ( id mediumint unsigned primary key, i1 mediumint unsigned, i2 mediumint unsigned, i3 mediumint unsigned );
insert into t1 values (109,109,109,109),(1,1,1,1),(20,20,20,20),(8388608,8388608,8388608,8388608),(0,0,0,0),(16777215,16777215,16777215,16777215);
alter table t1 change id id bit(32), algorithm=inplace;
alter table t1 change i1 i1 mediumint unsigned, algorithm=inplace;
alter table t1 change i2 i2 int unsigned, algorithm=inplace;
alter table t1 change i3 i3 bigint unsigned, algorithm=inplace;
show create table t1;
insert into t1 values (b'10101010101010101010101010101010',16777214,4294967295,18446744073709551615), (b'100110011100110011',16777213,4294967294,18446744073709551614);
select * from t1 order by id;
drop table t1;

create table t1 ( id mediumint unsigned primary key );
insert into t1 values (109),(1),(20),(8388608),(0),(16777215);
alter table t1 modify id set('a1','a2','a3','a4','a5','a6','a7','a8','a9','a10','a11', 'a12', 'a13', 'a14', 'a15', 'a16', 'b1','b2','b3','b4','b5','b6','b7','b8','b9','b10','b11', 'b12', 'b13', 'b14', 'b15', 'b16'), algorithm=inplace;
show create table t1;
insert into t1 values ('a1,b2');
select * from t1 order by id;
drop table t1;

create table t1 ( id mediumint unsigned primary key, i1 mediumint unsigned, i2 mediumint unsigned );
insert into t1 values (109,109,109),(1,1,1),(20,20,20),(8388608,8388608,8388608),(0,0,0),(16777215,16777215,16777215);
#BUG #SEQUOIASQLMAINSTREAM-417
--error 1846
alter table t1 change id id float(12,1) unsigned, algorithm=inplace;
alter table t1 modify i1 double unsigned, algorithm=inplace;
alter table t1 modify i2 decimal(16,3) unsigned, algorithm=inplace;
show create table t1;
insert into t1 values (2.1000000000000001,1.1000000000000001,1.1000000000000001),(10.48,10.48E+03,10.48);
select * from t1 order by id;
#BUG #SEQUOIASQLMAINSTREAM-417
--error 1846
alter table t1 change id id float(12,1), algorithm=inplace;
alter table t1 modify i1 double, algorithm=inplace;
alter table t1 modify i2 decimal(16,3), algorithm=inplace;
show create table t1;
insert into t1 values (3.1000000000000001,-1.1000000000000001,-1.1000000000000001),(30.48,-10.48E+03,-10.48);
select * from t1 order by id;
drop table t1;

create table t1 ( id int unsigned primary key, i1 int unsigned, i2 int unsigned );
insert into t1 values (109,109,109),(1,1,1),(20,20,20),(2147483648,2147483648,2147483648),(0,0,0),(4294967295,4294967295,4294967295);
alter table t1 change id id bit(32), algorithm=inplace;
alter table t1 change i1 i1 int unsigned, algorithm=inplace;
alter table t1 change i2 i2 bigint unsigned, algorithm=inplace;
show create table t1;
insert into t1 values (b'10101010101010101010101010101010',4294967294,18446744073709551615), (b'100110011100110011',4294967293,18446744073709551613);
select * from t1 order by id;
drop table t1;

create table t1 ( id int unsigned primary key );
insert into t1 values (109),(1),(20),(2147483648),(0),(4294967295);
alter table t1 modify id set('a1','a2','a3','a4','a5','a6','a7','a8','a9','a10','a11', 'a12', 'a13', 'a14', 'a15', 'a16', 'b1','b2','b3','b4','b5','b6','b7','b8','b9','b10','b11', 'b12', 'b13', 'b14', 'b15', 'b16'), algorithm=inplace;
show create table t1;
insert into t1 values ('a1,b2,a15,b16');
select * from t1 order by id;
drop table t1;

create table t1 ( id int unsigned primary key, i1 int unsigned, i2 int unsigned );
insert into t1 values (109,109,109),(1,1,1),(20,20,20),(2147483648,2147483648,2147483648),(0,0,0),(4294967295,4294967295,4294967295);
#BUG #SEQUOIASQLMAINSTREAM-417
--error 1846
alter table t1 change id id float(12,1) unsigned, algorithm=inplace;
alter table t1 modify i1 double unsigned, algorithm=inplace;
alter table t1 modify i2 decimal(16,3) unsigned, algorithm=inplace;
show create table t1;
insert into t1 values (2.1000000000000001,1.1000000000000001,1.1000000000000001),(10.48,10.48E+03,10.48);
select * from t1 order by id;
#BUG #SEQUOIASQLMAINSTREAM-417
--error 1846
alter table t1 change id id float(12,1), algorithm=inplace;
alter table t1 modify i1 double, algorithm=inplace;
alter table t1 modify i2 decimal(16,3), algorithm=inplace;
show create table t1;
insert into t1 values (3.1000000000000001,-1.1000000000000001,-1.1000000000000001),(30.48,-10.48E+03,-10.48);
select * from t1 order by id;
drop table t1;

create table t1 ( id bigint unsigned primary key, i1 bigint unsigned, i2 bigint unsigned, i3 bigint unsigned );
insert into t1 values (109,109,109,109),(1,1,1,1),(20,20,20,20),(9223372036854775808,9223372036854775808,9223372036854775808,9223372036854775808),(0,0,0,0),(18446744073709551613,18446744073709551613,18446744073709551613,18446744073709551613);
alter table t1 change id id bit(64), algorithm=inplace;
#BUG #SEQUOIASQLMAINSTREAM-417
--error 1846
alter table t1 change i1 i1 float(22,2), algorithm=inplace;
--error 1846
alter table t1 change i2 i2 double(22,2), algorithm=inplace;
alter table t1 change i3 i3 decimal(30,5), algorithm=inplace;
show create table t1;
insert into t1 values (b'1010101010101010101010101010101010101010101010101010101010101010',429496729448320.22,429496729448320.22,1844674407370955161584320.8342), (b'100110011100110011100110011100110011',429496729348293342.99,429496729348293342.99,48302446744073709551613.7239);
select hex(id), i1, i2, i3 from t1 order by id,i1;
drop table t1;

create table t1 ( id float unsigned primary key, f1 float(20,0) unsigned, f2 float(25,2) unsigned, f3 float(31,2) unsigned, f4 float(2,0) unsigned, f5 float(3,0) unsigned, f6 float(4,0) unsigned, f7 float(5,0) unsigned, f8 float(6,0) unsigned, f9 float(7,0) unsigned, f10 float(9,0) unsigned, f11 float(10,0) unsigned, f12 float(19,0) unsigned, f13 float(20,0) unsigned );
insert into t1 values (1.1000000000000001,1,1.1000000000000001,1.1000000000000001,9,9,9,9,9,9,9,9,9,9);
insert into t1 values (10.48,10,10.48,10.48E+03,10,101,101,101,101,101,101,101,101,101);
insert into t1 values (432908.32082,432908,432908.32,432908.32,11,111,111,111,111,111,111,111,111,111);
insert into t1 values (43829.32,43829,43829.32,43829.32,99,99,99,99,99,99,99,99,99,99);
insert into t1 values (4793.23,4793,4793.23,4793.23,1,1,1,1,1,1,1,1,1,1);
insert into t1 values (3240.12,3240,3240.12,3240.12,0,0,0,0,0,0,0,0,0,0);
alter table t1 change id id double unsigned, algorithm=inplace;
alter table t1 change f2 f2 float(28,2) unsigned, algorithm=inplace;
#BUG #SEQUOIASQLMAINSTREAM-420  
alter table t1 change f3 f3 decimal(40,2) unsigned, algorithm=inplace;
#BUG #SEQUOIASQLMAINSTREAM-424
--error 1846
alter table t1 change f4 f4 bit(8), algorithm=inplace;
--error 1846
alter table t1 change f5 f5 tinyint unsigned, algorithm=inplace;
--error 1846               
alter table t1 change f7 f7 smallint unsigned, algorithm=inplace;
--error 1846             
alter table t1 change f10 f10 mediumint unsigned, algorithm=inplace;
--error 1846                 
alter table t1 change f11 f11 int unsigned, algorithm=inplace;
--error 1846                 
alter table t1 change f13 f13 bigint unsigned, algorithm=inplace;
alter table t1 change f4 f4 tinyint , algorithm=inplace;
alter table t1 change f6 f6 smallint unsigned, algorithm=inplace;
alter table t1 change f8 f8 mediumint , algorithm=inplace;
alter table t1 change f10 f10 int unsigned, algorithm=inplace;
alter table t1 change f12 f12 bigint unsigned, algorithm=inplace;
show create table t1;
insert into t1 values (48329.3429,b'11111111111111111111111111111111111111111',4832948230840.11,480249208340274203842.23,6,6,6,6,6,6,6,6,6,6);
select * from t1 order by id;
alter table t1 change id id double, algorithm=inplace;                                
alter table t1 change f2 f2 float(28,2), algorithm=inplace;                           
#BUG #SEQUOIASQLMAINSTREAM-420
alter table t1 change f3 f3 decimal(40,2), algorithm=inplace; 
show create table t1;
insert into t1 values (-48329.3429,b'11111111111111111111111111111111111111111',-4832948230840.11,-480249208340274203842.23,7,7,7,7,7,7,7,7,7,7);
select * from t1 order by id;
drop table t1;

create table t1 ( id double unsigned primary key, f1 double(20,0) unsigned, f2 double(25,2) unsigned, f4 double(2,0) unsigned, f5 double(3,0) unsigned, f6 double(4,0) unsigned, f7 double(5,0) unsigned, f8 double(6,0) unsigned, f9 double(7,0) unsigned, f10 double(9,0) unsigned, f11 double(10,0) unsigned, f12 double(19,0) unsigned, f13 double(20,0) unsigned );
insert into t1 values (1.1000000000000001,1,1.1000000000000001,9,9,9,9,9,9,9,9,9,9);
insert into t1 values (10.48,10,10.48,10,101,101,101,101,101,101,101,101,101);
insert into t1 values (432908.32082,432908,432908.32,11,111,111,111,111,111,111,111,111,111);
insert into t1 values (43829.32,43829,43829.32,99,99,99,99,99,99,99,99,99,99);
insert into t1 values (4793.23,4793,4793.23,1,1,1,1,1,1,1,1,1,1);
insert into t1 values (3240.12,3240,3240.12,0,0,0,0,0,0,0,0,0,0);
#BUG #SEQUOIASQLMAINSTREAM-420
alter table t1 change f2 f2 decimal(40,2) unsigned, algorithm=inplace;
show create table t1;              
insert into t1 values (48329.3429,b'11111111111111111111111111111111111111111',4832948230840.11,6,6,6,6,6,6,6,6,6,6);
select * from t1 order by id;
#BUG #SEQUOIASQLMAINSTREAM-420
alter table t1 change f2 f2 decimal(40,2), algorithm=inplace;
#BUG #SEQUOIASQLMAINSTREAM-424
--error 1846
alter table t1 change f4 f4 bit(8), algorithm=inplace;
--error 1846
alter table t1 change f5 f5 tinyint unsigned, algorithm=inplace;
--error 1846               
alter table t1 change f7 f7 smallint unsigned, algorithm=inplace;
--error 1846             
alter table t1 change f10 f10 mediumint unsigned, algorithm=inplace;
--error 1846                 
alter table t1 change f11 f11 int unsigned, algorithm=inplace;
--error 1846                 
alter table t1 change f13 f13 bigint unsigned, algorithm=inplace;
alter table t1 change f4 f4 tinyint , algorithm=inplace;
alter table t1 change f6 f6 smallint unsigned, algorithm=inplace;
alter table t1 change f8 f8 mediumint , algorithm=inplace;
alter table t1 change f10 f10 int unsigned, algorithm=inplace;
alter table t1 change f12 f12 bigint unsigned, algorithm=inplace;
show create table t1;
insert into t1 values (74293.32,b'11111111111111111111111111111111111111111',480249208340274203842.23,7,7,7,7,7,7,7,7,7,7);
select * from t1 order by id;
drop table t1;

create table t1 ( id decimal unsigned primary key, f1 decimal(20,0) unsigned, f2 decimal(25,2) unsigned, f4 decimal(2,0) unsigned, f5 decimal(3,0) unsigned, f6 decimal(4,0) unsigned, f7 decimal(5,0) unsigned, f8 decimal(6,0) unsigned, f9 decimal(7,0) unsigned, f10 decimal(9,0) unsigned, f11 decimal unsigned, f12 decimal(19,0) unsigned, f13 decimal(20,0) unsigned  );
insert into t1 values (1.1000000000000001,1,1.1000000000000001,9,9,9,9,9,9,9,9,9,9);
insert into t1 values (10.48,10,10.48,10,101,101,101,101,101,101,101,101,101);
insert into t1 values (432908.32082,432908,432908.32,11,111,111,111,111,111,111,111,111,111);
insert into t1 values (43829.32,43829,43829.32,99,99,99,99,99,99,99,99,99,99);
insert into t1 values (4793.23,4793,4793.23,1,1,1,1,1,1,1,1,1,1);
insert into t1 values (3240.12,3240,3240.12,0,0,0,0,0,0,0,0,0,0);
alter table t1 change id id decimal(40,2) unsigned, algorithm=inplace;
show create table t1;
insert into t1 values (48329.3429,b'11111111111111111111111111111111111111111',4832948230840.11,6,6,6,6,6,6,6,6,6,6);
select * from t1 order by id;
alter table t1 change id id decimal(40,2), algorithm=inplace;
#BUG #SEQUOIASQLMAINSTREAM-424
--error 1846
alter table t1 change f4 f4 bit(8), algorithm=inplace;
--error 1846
alter table t1 change f5 f5 tinyint unsigned, algorithm=inplace;
--error 1846               
alter table t1 change f7 f7 smallint unsigned, algorithm=inplace;
--error 1846             
alter table t1 change f10 f10 mediumint unsigned, algorithm=inplace;
--error 1846                 
alter table t1 change f11 f11 int unsigned, algorithm=inplace;
--error 1846                 
alter table t1 change f13 f13 bigint unsigned, algorithm=inplace;
alter table t1 change f4 f4 tinyint , algorithm=inplace;
alter table t1 change f6 f6 smallint unsigned, algorithm=inplace;
alter table t1 change f8 f8 mediumint , algorithm=inplace;
alter table t1 change f10 f10 int unsigned, algorithm=inplace;
alter table t1 change f12 f12 bigint unsigned, algorithm=inplace;
show create table t1;      
insert into t1 values (-48329.3429,b'11111111111111111111111111111111111111111',480249208340274203842.23,7,7,7,7,7,7,7,7,7,7);
select * from t1 order by id;
drop table t1;

create table t1 ( id char(8) primary key, c1 char(16), c2 char(32), c3 char(64), c4 char(128), c5 char(255) );
insert into t1 values ("ufsdo2","ufsdo2","ufsdo2","ufsdo2","ufsdo2","ufsdo2"),("24ijrfsw","24ijrfsw","24ijrfsw","24ijrfsw","24ijrfsw","24ijrfsw"),("e29wdf","e29wdf","e29wdf","e29wdf","e29wdf","e29wdf"),("aaa","aaa","aaa","aaa","aaa","aaa"),("47293jr","47293jr","47293jr","47293jr","47293jr","47293jr"),("he",'he','he','he','he','he');
alter table t1 modify id char(9), algorithm=inplace;
alter table t1 modify c1 varchar(16), algorithm=inplace;
alter table t1 modify c2 tinytext, algorithm=inplace;
alter table t1 modify c3 text, algorithm=inplace;
alter table t1 modify c4 mediumtext, algorithm=inplace;
alter table t1 modify c5 longtext, algorithm=inplace;
show create table t1;
insert into t1 values ("123456789","123456789abcdefg","gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj");
select * from t1 order by id;
drop table t1;

create table t1 ( id varchar(32) primary key, c1 varchar(128), c2 varchar(256), c3 varchar(512), c4 varchar(4096) );
insert into t1 values ("ufsdo2","ufsdo2","ufsdo2","ufsdo2","ufsdo2"),("24ijrfsw","24ijrfsw","24ijrfsw","24ijrfsw","24ijrfsw"),("e29wdf","e29wdf","e29wdf","e29wdf","e29wdf"),("aaa","aaa","aaa","aaa","aaa"),("47293jr","47293jr","47293jr","47293jr","47293jr"),("he",'he','he','he','he');
#BUG #SEQUOIASQLMAINSTREAM-396
--error 1846
alter table t1 modify c1 char(255), algorithm=inplace;
alter table t1 modify c1 varchar(129), algorithm=inplace;
alter table t1 modify c2 text, algorithm=inplace;
alter table t1 modify c3 mediumtext, algorithm=inplace;
alter table t1 modify c4 longtext, algorithm=inplace;
show create table t1;
insert into t1 values ("123456789","123456789abcdefg","gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj");
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, c1 tinytext, c2 tinytext, c3 tinytext, c4 tinytext );
insert into t1(c1,c2,c3,c4) values ("ufsdo2","ufsdo2","ufsdo2","ufsdo2"),("24ijrfsw","24ijrfsw","24ijrfsw","24ijrfsw"),("e29wdf","e29wdf","e29wdf","e29wdf"),("aaa","aaa","aaa","aaa"),("47293jr","47293jr","47293jr","47293jr"),("he",'he','he','he');
alter table t1 modify c1 varchar(255), algorithm=inplace;
#BUG #SEQUOIASQLMAINSTREAM-396
--error 1846
alter table t1 modify c1 char(255), algorithm=inplace;
alter table t1 modify c2 text, algorithm=inplace;
alter table t1 modify c3 mediumtext, algorithm=inplace;
alter table t1 modify c4 longtext, algorithm=inplace;
show create table t1;
insert into t1(c1,c2,c3,c4) values ("123456789abcdefg","gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj");
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, c1 text, c2 text, c3 text );
insert into t1(c1,c2,c3) values ("ufsdo2","ufsdo2","ufsdo2"),("24ijrfsw","24ijrfsw","24ijrfsw"),("e29wdf","e29wdf","e29wdf"),("aaa","aaa","aaa"),("47293jr","47293jr","47293jr"),("he",'he','he');
#BUG #SEQUOIASQLMAINSTREAM-396
--error 1846
alter table t1 modify c1 char(255), algorithm=inplace;
alter table t1 change c1 c1 text, algorithm=inplace;
alter table t1 change c2 c2 mediumtext, algorithm=inplace;
alter table t1 change c3 c3 longtext, algorithm=inplace;
show create table t1;
insert into t1(c1,c2,c3) values ("gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj");
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, c1 mediumtext, c2 mediumtext );
insert into t1(c1,c2) values ("ufsdo2","ufsdo2"),("24ijrfsw","24ijrfsw"),("e29wdf","e29wdf"),("aaa","aaa"),("47293jr","47293jr"),("he",'he');
#BUG #SEQUOIASQLMAINSTREAM-396
--error 1846
alter table t1 modify c1 char(255), algorithm=inplace;
alter table t1 change c1 c1 mediumtext, algorithm=inplace;
alter table t1 change c2 c2 longtext, algorithm=inplace;
show create table t1;
insert into t1(c1,c2) values ("gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj");
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, c1 longtext );
insert into t1(c1) values ("ufsdo2"),("24ijrfsw"),("e29wdf"),("aaa"),("47293jr"),("he");
#BUG #SEQUOIASQLMAINSTREAM-396
--error 1846
alter table t1 modify c1 char(255), algorithm=inplace;
alter table t1 change c1 c1 longtext, algorithm=inplace;
show create table t1;
insert into t1(c1) values ("gjoewjrlw342982jlfsfjslfjslr942lj");
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, b1 binary(8), b2 binary(16), b3 binary(32), b4 binary(64), b5 binary(128), b6 binary(255) );
insert into t1(b1,b2,b3,b4,b5,b6) values ("ufsdo2","ufsdo2","ufsdo2","ufsdo2","ufsdo2","ufsdo2"),("24ijrfsw","24ijrfsw","24ijrfsw","24ijrfsw","24ijrfsw","24ijrfsw"),("e29wdf","e29wdf","e29wdf","e29wdf","e29wdf","e29wdf"),("aaa","aaa","aaa","aaa","aaa","aaa"),("47293jr","47293jr","47293jr","47293jr","47293jr","47293jr"),("he",'he','he',"he",'he','he');
alter table t1 modify b1 binary(17), algorithm=inplace;
alter table t1 modify b2 varbinary(32), algorithm=inplace;
alter table t1 modify b3 tinyblob, algorithm=inplace;
alter table t1 modify b4 blob, algorithm=inplace;
alter table t1 modify b5 mediumblob, algorithm=inplace;
alter table t1 modify b6 longblob, algorithm=inplace;
show create table t1;
insert into t1(b1,b2,b3,b4,b5,b6) values ("123456789","123456789abcdefg","gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj");
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, b1 varbinary(128), b2 varbinary(256), b3 varbinary(512), b4 varbinary(4096), b5 varbinary(8192) );
insert into t1(b1,b2,b3,b4,b5) values ("ufsdo2","ufsdo2","ufsdo2","ufsdo2","ufsdo2"),("24ijrfsw","24ijrfsw","24ijrfsw","24ijrfsw","24ijrfsw"),("e29wdf","e29wdf","e29wdf","e29wdf","e29wdf"),("aaa","aaa","aaa","aaa","aaa"),("47293jr","47293jr","47293jr","47293jr","47293jr"),("he",'he','he',"he",'he');
#BUG #SEQUOIASQLMAINSTREAM-396
--error 1846
alter table t1 modify b1 binary(255), algorithm=inplace;
alter table t1 modify b1 varbinary(129), algorithm=inplace;
alter table t1 modify b2 blob, algorithm=inplace;
alter table t1 modify b3 mediumblob, algorithm=inplace;
alter table t1 modify b4 longblob, algorithm=inplace;
show create table t1;
insert into t1(b1,b2,b3,b4,b5) values ("123456789","123456789abcdefg","gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj");
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, c1 tinyblob, c2 tinyblob, c3 tinyblob, c4 tinyblob );
insert into t1(c1,c2,c3,c4) values ("ufsdo2","ufsdo2","ufsdo2","ufsdo2"),("24ijrfsw","24ijrfsw","24ijrfsw","24ijrfsw"),("e29wdf","e29wdf","e29wdf","e29wdf"),("aaa","aaa","aaa","aaa"),("47293jr","47293jr","47293jr","47293jr"),("he",'he','he',"he");
#BUG #SEQUOIASQLMAINSTREAM-396
--error 1846
alter table t1 modify c1 binary(255), algorithm=inplace;
alter table t1 modify c1 varbinary(255), algorithm=inplace;
alter table t1 modify c2 blob, algorithm=inplace;
alter table t1 modify c3 mediumblob, algorithm=inplace;
alter table t1 modify c4 longblob, algorithm=inplace;
show create table t1;
insert into t1(c1,c2,c3,c4) values ("123456789abcdefg","gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj");
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, c1 blob, c2 blob, c3 blob );
insert into t1(c1,c2,c3) values ("ufsdo2","ufsdo2","ufsdo2"),("24ijrfsw","24ijrfsw","24ijrfsw"),("e29wdf","e29wdf","e29wdf"),("aaa","aaa","aaa"),("47293jr","47293jr","47293jr"),("he",'he','he');
#BUG #SEQUOIASQLMAINSTREAM-396
--error 1846
alter table t1 modify c1 binary(255), algorithm=inplace;
alter table t1 change c1 c1 blob, algorithm=inplace;
alter table t1 change c2 c2 mediumblob, algorithm=inplace;
alter table t1 change c3 c3 longblob, algorithm=inplace;
show create table t1;
insert into t1(c1,c2,c3) values ("gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj");
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, c1 mediumblob, c2 mediumblob );
insert into t1(c1,c2) values ("ufsdo2","ufsdo2"),("24ijrfsw","24ijrfsw"),("e29wdf","e29wdf"),("aaa","aaa"),("47293jr","47293jr"),("he",'he');
#BUG #SEQUOIASQLMAINSTREAM-396
--error 1846
alter table t1 modify c1 binary(255), algorithm=inplace;
alter table t1 change c1 c1 mediumblob, algorithm=inplace;
alter table t1 change c2 c2 longblob, algorithm=inplace;
show create table t1;
insert into t1(c1,c2) values ("gjoewjrlw342982jlfsfjslfjslr942lj","gjoewjrlw342982jlfsfjslfjslr942lj");
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, c1 longblob );
insert into t1(c1) values ("ufsdo2"),("24ijrfsw"),("e29wdf"),("aaa"),("47293jr"),("he");
#BUG #SEQUOIASQLMAINSTREAM-396
--error 1846
alter table t1 modify c1 binary(255), algorithm=inplace;
alter table t1 change c1 c1 longblob, algorithm=inplace;
show create table t1;
insert into t1(c1) values ("gjoewjrlw342982jlfsfjslfjslr942lj");
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, y1 year );
insert into t1(y1) values (1901),(2019),(2001),(2020),(2155),(2154);
alter table t1 change y1 y1 year, algorithm=inplace;
show create table t1;
insert into t1(y1) values (1999),(2008),(2111);
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, y1 time(4) );
insert into t1(y1) values ("23:59:59.000"),("837:59:59.9999"),("09:50:50.998"),("00:00:00.111"),("12:12:12.12"),("838:59:00.9999");
alter table t1 modify y1 time(6), algorithm=inplace;
show create table t1;
insert into t1(y1) values ("02:02:02.009900"),("-837:59:59.999");
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, d1 date );                                   
insert into t1(d1) values ("2010-10-10"),("2005-05-05"),("2000-1-19"),("1999-09-09"),("2013-07-01"),("2019-12-25");
alter table t1 modify d1 date, algorithm=inplace;
show create table t1;   
insert into t1(d1) values ("2037-12-31"),("2021-01-01");
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, d1 datetime(4) );                                      
insert into t1(d1) values ("2010-10-10 23:59:59.000"),("2005-05-05 09:50:50.998"),("2000-1-19 00:00:00.111"),("1999-09-09 12:12:12.12 "),("2013-07-01 19:19:19.992"),("2019-12-25 01:01:01.9999"),('2021-01-15 15:30:34');
--error 1846
alter table t1 modify d1 datetime(6), algorithm=inplace;
#Bug #SEQUOIASQLMAINSTREAM-916
#seqDB-23430
alter table t1 modify d1 datetime(6), algorithm=copy;
select * from t1 where d1 = '2021-01-15 15:30:34';
#BUG #SEQUOIASQLMAINSTREAM-425
--error 1846
alter table t1 modify d1 datetime(5), algorithm=inplace;
show create table t1;                             
insert into t1(d1) values ("2037-12-31 02:02:02.009900"),("2021-01-01 10:11:12.131415");
select * from t1 order by id;
drop table t1;
create table t1 ( id int auto_increment primary key, d1 timestamp(4) );                                      
insert into t1(d1) values ("2010-10-10 23:59:59.000"),("2005-05-05 09:50:50.998"),("2000-1-19 00:00:00.111"),("1999-09-09 12:12:12.12 "),("2013-07-01 19:19:19.992"),("2019-12-25 01:01:01.9999");                                                     
alter table t1 modify d1 timestamp(6), algorithm=inplace;                   
#BUG #SEQUOIASQLMAINSTREAM-425
--error 1846
alter table t1 modify d1 timestamp(5), algorithm=inplace;
show create table t1;                                                      
insert into t1(d1) values ("2037-12-31 02:02:02.009900"),("2021-01-01 10:11:12.131415");
select * from t1 order by id;
drop table t1;

create table t1 ( id int auto_increment primary key, j json );
insert into t1(j) values (NULL),('{"a": 2}'),('[1,2]'),('{"a":"b", "c":"d","ab":"abc", "bc": ["x", "y"]}'),('["here", ["I", "am"], "!!!"]'),('"scalar string"');
alter table t1 change j j json, algorithm=inplace;
show create table t1;
insert into t1(j) values ('true'),('false');
select * from t1 order by id;
drop table t1;

#seqDB-20023
CREATE TABLE t1(a TINYINT NOT NULL AUTO_INCREMENT,  PRIMARY KEY(a));
ALTER TABLE t1 AUTO_INCREMENT = 0;
SHOW CREATE TABLE t1;
ALTER TABLE t1 AUTO_INCREMENT = 1;
SHOW CREATE TABLE t1;
ALTER TABLE t1 AUTO_INCREMENT = 100;
SHOW CREATE TABLE t1;
ALTER TABLE t1 AUTO_INCREMENT = 126;
SHOW CREATE TABLE t1;
ALTER TABLE t1 AUTO_INCREMENT = 127;
SHOW CREATE TABLE t1;
ALTER TABLE t1 AUTO_INCREMENT = 127;
SHOW CREATE TABLE t1;
DROP TABLE t1;

#seqDB-20024
CREATE TABLE t1(a TINYINT NOT NULL AUTO_INCREMENT,  PRIMARY KEY(a));
INSERT INTO t1 VALUES(),(),();
ALTER TABLE t1 AUTO_INCREMENT = 0;
SHOW CREATE TABLE t1;
ALTER TABLE t1 AUTO_INCREMENT = 1;
SHOW CREATE TABLE t1;
ALTER TABLE t1 AUTO_INCREMENT = 100;
SHOW CREATE TABLE t1;
ALTER TABLE t1 AUTO_INCREMENT = 126;
SHOW CREATE TABLE t1;
ALTER TABLE t1 AUTO_INCREMENT = 127;
SHOW CREATE TABLE t1;
ALTER TABLE t1 AUTO_INCREMENT = 127;
SHOW CREATE TABLE t1;
DROP TABLE t1;

#seqDB-20028
create table t1 ( id int auto_increment primary key, a tinytext ) ;
insert into t1(a) values ('hello'),('hello ');
select * from t1 where a = 'hello' order by id;
select * from t1 where a = 'hello ' order by id;
alter table t1 change a a char(255), ALGORITHM = COPY;
show create table t1;
select * from t1 where a = 'hello' order by id;
select * from t1 where a = 'hello ' order by id;
drop table t1;

#seqDB-20422
create table t1(a int(10)unsigned not null auto_increment primary key, b varchar(255) not null) default charset=utf8;
insert into t1 values(1,'aaa'),(2,'bbb');
alter table t1 auto_increment=1;
insert into t1 values(NULL, 'ccc');
select * from t1 order by a;
show create table t1;
alter table t1 auto_increment=3;
insert into t1 values(NULL, 'ddd');
select * from t1 order by a;
show create table t1;
drop table t1;

#seqDB-20386
create table t1( id int ) comment = "sequoiadb : { table_options: { ShardingKey: {id : 1}, IsMainCL: true } }";
--error 131
alter table t1 comment = "sequoiadb : { table_options: { ShardingKey: {id : 1}, IsMainCL: true, StrictDataMode:false } }", ALGORITHM=copy;
drop table t1;

#seqDB-20388
create table t1( id int auto_increment primary key ) comment = "sequoiadb : { table_options: { ShardingKey: {id : 1}, IsMainCL: true } }";
alter table t1 rename t2, ALGORITHM=copy;
--error 1146
show create table t1;
show create table t2;
alter table t2 auto_increment = 10, ALGORITHM=copy;
show create table t2;
drop table t2;

#seqDB-20389 #seqDB-20396
create table t1( id int primary key, b blob, c char(16), key c(c(2)) ) comment = "sequoiadb : { table_options: { ShardingKey: {id : 1}, IsMainCL: true } }";
create table t2( id int primary key, c char(16), key c(c(2)) ) comment = "sequoiadb : { table_options: { ShardingKey: {id : 1} } }";
alter table t1 drop index c, add index c_new(c(8)), ALGORITHM=copy;
alter table t1 drop primary key, ALGORITHM=copy;
alter table t2 drop index c, add index c_new(c(8)), ALGORITHM=copy;
alter table t2 drop primary key, ALGORITHM=copy;
show create table t1;
show create table t2;
alter table t1 add primary key (id), ALGORITHM=copy;
alter table t1 drop index c_new, add unique key c_new(c(8),id), ALGORITHM=copy;
alter table t2 add primary key (id), ALGORITHM=copy;
alter table t2 drop index c_new, add unique key c_new(c(8),id), ALGORITHM=copy;
show create table t1;
show create table t2;
#BUG SEQUOIASQLMAINSTREAM-572 
--error 138
alter table t1 add index b(b(1)), ALGORITHM=copy;
show create table t1;
alter table t1 drop primary key, add index(id) using hash, ALGORITHM=copy;
alter table t2 drop primary key, add index(id) using hash, ALGORITHM=copy;
show create table t1;
show create table t2;
drop table t1,t2;

#seqDB-20390 #seqDB-20397
create table t1( c char(16) ) comment = "sequoiadb : { table_options: { ShardingKey: {id : 1}, IsMainCL: true } }";
create table t2( c char(16) ) comment = "sequoiadb : { table_options: { ShardingKey: {id : 1} } }";
alter table t1 add column id int auto_increment primary key, ALGORITHM=copy;
alter table t1 change c c char(16) comment 'column c', add column t text comment 'column t', add index t(t(2)), ALGORITHM=copy;
alter table t2 add column id int auto_increment primary key, ALGORITHM=copy;
alter table t2 change c c char(16) comment 'column c', add column t text comment 'column t', add index t(t(2)), ALGORITHM=copy;
show create table t1;
show create table t2;
#BUG SEQUOIASQLMAINSTREAM-572
#BUG SEQUOIASQLMAINSTREAM-589
--error 40177
alter table t1 change id id1 int, ALGORITHM=copy;
--error 40177
alter table t1 add unique index c(c), ALGORITHM=copy;
show create table t1;
alter table t1 change id id int, ALGORITHM=copy;
alter table t2 change id id int, ALGORITHM=copy;
show create table t1;
show create table t2;
alter table t1 add column id1 int auto_increment, add index id1(id1), ALGORITHM=copy;
alter table t2 add column id1 int auto_increment, add index id1(id1), ALGORITHM=copy;
show create table t1;
show create table t2;
alter table t1 drop column id1, add column b blob, change c c1 char(16), ALGORITHM=copy;
alter table t2 drop column id1, add column b blob, change c c1 char(16), ALGORITHM=copy;
show create table t1;
show create table t2;
drop table t1,t2;

#seqDB-20398 #seqDB-20399 
create table t1( c char(16) ) comment = "sequoiadb : { table_options: { ShardingKey: {id : 1}, IsMainCL: true, ReplSize: 2 } }";
create table t2( c char(16) ) comment = "sequoiadb : { table_options: { ShardingKey: {id : 1}, AutoIndexId: false, StrictDataMode: false  } }";
create table t1_new like t1;
create table t2_new like t2;
show create table t1_new;
show create table t2_new;
drop table t1,t2,t1_new,t2_new;

#seqDB-20473 
create table t1( id int ) comment = "sequoiadb : { table_options: { ShardingKey: {id : 1}, IsMainCL: true } }";
alter table t1 comment = "user string, sequoiadb : { table_options: { ShardingKey: {id : 1}, IsMainCL: true } }", ALGORITHM=copy;
show create table t1;
drop table t1;

#seqDB-20474
create table t1 ( id int, d date )
   PARTITION BY RANGE( YEAR(d) )
   SUBPARTITION BY HASH( TO_DAYS(d) )
   SUBPARTITIONs 2 (
      PARTITION p0 VALUES LESS THAN (1990)
   );
show create table t1;
#BUG #SEQUOIASQLMAINSTREAM-576
--error 131
alter table t1 comment = 'sequoiadb: { partition_options:  { Partition : 1024 } }',  ALGORITHM=COPY; 
show create table t1;
drop table t1;

#BUG #SEQUOIASQLMAINSTREAM-578
create table t1 ( POPulation int(11) not null default '0', index (POPulation));
insert into t1 values (1);
--error 131
alter table t1 change population population int(11) null;
# alter with copy is allowed
alter table t1 change population population int(11) null, ALGORITHM=COPY;
show create table t1;
drop table t1;

#BUG SEQUOIASQLMAINSTREAM-585
#seqDB-21866
--error 1210
create table t1 ( a int ) comment = 'sequoiadb:{ table_options: { Compressed: false }, ShardingKey: { wk: 1 }, EnsureShardingIndex: false } }';
--error 1210
create table t1 ( a int ) comment = 'sequoiadb:{ table_options: { ReplSize: 2 }, shardType: \"range\" }';
--error 1210
create table t1 ( a int ) comment = 'sequoiadb:{ partition_options: { Partition: 1024 }, Compressed: false }';
--error 1210
create table t1 ( a int ) comment = 'sequoiadb:{ partition_option: { Partition: 1024 } }';
--error 1210
create table t1 ( a int ) comment = 'sequoiadb:{ table_option: { ReplSize: 2 } }';
--error 1210
create table t1 ( a int ) comment = 'sequoiadb:{ auto_partion: true }';
#BUG #SEQUOIASQLMAINSTREAM-591
create table t1 ( a int );
--error 1210
alter table t1 comment = 'sequoiadb:{ table_options: { Compressed: false }, ShardingKey: { wk: 1 }, EnsureShardingIndex: false } }';
--error 1210
alter table t1 comment = 'sequoiadb:{ partition_options: { Partition: 1024 }, Compressed: false }';
--error 1210
alter table t1 comment = 'sequoiadb:{ partition_option: { Partition: 1024 } }';
--error 1210
alter table t1 comment = 'sequoiadb:{ table_option: { ReplSize: 2 } }';
show create table t1;
drop table t1;

#BUG #SEQUOIASQLMAINSTREAM-517
#SeqDB-21871
create table t1 ( a int not null, index(a) ) ; 
insert into t1 values (1);
alter table t1 modify a int null; 
show create table t1;
insert into t1 values (null); 
select * from t1;
drop table t1;

#SeqDB-21872
create table t1 ( a int not null, b int not null, c char(16) not null, index(a,b,c) );
create table t2 ( a int not null, b int not null, c char(16) not null, index(a,b,c) );
insert into t1 values (1,1,'a');
insert into t2 values (1,1,'a');
alter table t1 change a a int null, change b b int null;
alter table t2 change a a int null, change b b int null, change c c char(16) null;
show create table t1;
show create table t2;
insert into t1 values (null,null,'b');
insert into t2 values (null,null,null);
select * from t1;
select * from t2;
drop table t1,t2;

#SeqDB-21873
create table t1 ( a int, b int, c char(16) not null, index(a,b,c) );
create table t2 ( a int, b int, c char(16), index(a,b,c) );
insert into t1 values (1,1,'a'),(null,null,'b');
insert into t2 values (1,1,'a'),(null,null,null);
--error 1138 
alter table t1 change a a int not null, change b b int not null;
--error 1138
alter table t2 change a a int not null, change b b int not null, change c c char(16) not null;
delete from t1 where a is null;
delete from t2 where a is null;
alter table t1 change a a int not null, change b b int not null;
alter table t2 change a a int not null, change b b int not null, change c c char(16) not null;
show create table t1;
show create table t2;
insert into t1 values (2,2,'b');
insert into t2 values (2,2,'b');
select * from t1;
select * from t2;
drop table t1,t2;

#BUG #SEQUOIASQLMAINSTREAM-658
#SeqDB-22221
create table t1 ( id int , c char(8) );
create table t2 ( id int primary key );
alter table t1 add foreign key f1(id) references t2(id);
show create table t1;
alter table t1 drop foreign key t1_ibfk_1;
show create table t1;
drop table t1,t2;

#seqDB-22487
create table t1 (id int auto_increment primary key, a char(10));
alter table t1 modify a char(9),algorithm=inplace;
insert into t1(a) values('aaaaaaaa'),('aaaaaaaa'),('aaaaaaaa'),('aaaaaaaa'),('aaaaaaa '),('aaaaaa ');
--error 1406
alter table t1 modify a char(7),algorithm=inplace;
alter table t1 modify a char(8),algorithm=inplace;
--error 1846
alter table t1 modify a varchar(7),algorithm=inplace;
alter table t1 modify a varchar(8),algorithm=inplace;
alter table t1 modify a char(255);
alter table t1 modify a tinytext,algorithm=inplace;
alter table t1 modify a char(255);
--error 1846
alter table t1 modify a binary(100),algorithm=inplace;

--disable_warnings
set sql_mode='';
--enable_warnings
--error 1846
alter table t1 modify a char(100),algorithm=inplace;
--disable_warnings
set sql_mode=default;
--enable_warnings

select * from t1 order by id;
drop table t1;

#seqDB-22488
create table t1 (id int auto_increment primary key, a varchar(10));
alter table t1 modify a varchar(9),algorithm=inplace;
insert into t1(a) values('aaaaaaaa'),('aaaaaaaa'),('aaaaaaaa'),('aaaaaaaa'),('aaaaaaa '),('aaaaaa ');
--error 1406
alter table t1 modify a varchar(7),algorithm=inplace;
alter table t1 modify a varchar(8),algorithm=inplace;
--error 1846
alter table t1 modify a char(8),algorithm=inplace;
alter table t1 modify a varchar(255),algorithm=inplace;
alter table t1 modify a tinytext,algorithm=inplace;
alter table t1 modify a varchar(255);
--error 1846
alter table t1 modify a varbinary(100),algorithm=inplace;

--disable_warnings
set sql_mode='';
--enable_warnings
--error 1846
alter table t1 modify a varchar(100),algorithm=inplace;
--disable_warnings
set sql_mode=default;
--enable_warnings

select * from t1 order by id;
drop table t1;

#seqDB-22490
create table t1 (id int auto_increment primary key, a longtext);
alter table t1 modify a mediumtext,algorithm=inplace;
insert into t1(a) values('aaaaaaaa'),('aaaaaaaa'),('aaaaaaaa'),('aaaaaaaa'),('aaaaaaa '),('aaaaaa ');
insert into t1(a) values(repeat('a', 256));
--error 1406
alter table t1 modify a tinytext,algorithm=inplace;
alter table t1 modify a text,algorithm=inplace;
delete from t1 where length(a)>254;
--error 1846
alter table t1 modify a char(255),algorithm=inplace;
alter table t1 modify a varchar(255),algorithm=inplace;
alter table t1 modify a text,algorithm=inplace;
--error 1846
alter table t1 modify a tinyblob,algorithm=inplace;

--disable_warnings
set sql_mode='';
--enable_warnings
--error 1846
alter table t1 modify a tinytext,algorithm=inplace;
--disable_warnings
set sql_mode=default;
--enable_warnings

select * from t1 order by id;
drop table t1;

#seqDB-22495
create table t1 (id int auto_increment primary key, a binary(255), b varbinary(255), c blob, d set('a','b','c'), e enum('a','b','c'));
--error 1846
alter table t1 modify a binary(100),algorithm=inplace;
--error 1846
alter table t1 modify b varbinary(100),algorithm=inplace;
--error 1846
alter table t1 modify c tinyblob,algorithm=inplace;
--error 1846
alter table t1 modify d set('a','b'),algorithm=inplace;
--error 1846
alter table t1 modify e enum('a','b'),algorithm=inplace;
drop table t1;

#seqDB-22492
create table t1 (id int auto_increment primary key, a bigint, b bigint unsigned);
alter table t1 modify a int, modify b int unsigned,algorithm=inplace;
insert into t1(a, b) values(-32769,0),(-32768,1),(0,2),(32767,65535),(32768,65536);
alter table t1 modify a mediumint, modify b mediumint unsigned,algorithm=inplace;
--error 1406
alter table t1 modify a smallint, modify b smallint unsigned,algorithm=inplace;
--error 1846
alter table t1 modify a float, modify b smallint unsigned,algorithm=inplace;
--error 1846
alter table t1 modify a int unsigned, modify b smallint unsigned,algorithm=inplace;
delete from t1 where a not between -128 and 127;

--disable_warnings
set sql_mode='';
--enable_warnings
--error 1846
alter table t1 modify a tinyint,algorithm=inplace;
--disable_warnings
set sql_mode=default;
--enable_warnings

select * from t1 order by id;
drop table t1;

#seqDB-22494
create table t1 (id int auto_increment primary key, a float, b double, c decimal);
--error 1846
alter table t1 modify a float(2,0),algorithm=inplace;
--error 1846
alter table t1 modify b double(2,0),algorithm=inplace;
--error 1846
alter table t1 modify c decimal(2,0),algorithm=inplace;
drop table t1;

#  seqDB-22786:  Modity the geometry type field
create table `t1` (
  id int not null auto_increment primary key,
  `geom` geometry DEFAULT NULL,
  `poin` point DEFAULT NULL,
  `line` linestring DEFAULT NULL,
  `poly` polygon DEFAULT NULL,
  `mpoin` multipoint DEFAULT NULL,
  `mline` multilinestring DEFAULT NULL,
  `mploy` multipolygon DEFAULT NULL,
  `geocol` geometrycollection DEFAULT NULL,
  `geom1` geometry not null,
  `poin1` point not null,
  `line1` linestring not null,
  `poly1` polygon not null,
  `mpoin1` multipoint not null,
  `mline1` multilinestring not null,
  `mploy1` multipolygon not null,
  `geocol1` geometrycollection not null
);

show create table t1;

set @a1 = ST_PointFromText('POINT(1 1)');
set @a2 = ST_LineFromText('LINESTRING(0 0,10 10,20 25,50 60)');
set @a3 = ST_PolygonFromText('POLYGON((0 0,10 0,10 10,0 10,0 0),(5 5,7 5,7 7,5 7,5 5))');
set @a4 = ST_MultiPointFromText('MULTIPOINT(10 10,20 20)');
set @a5 = ST_MLineFromText('MULTILINESTRING((10 10,20 20),(15 15,30 15))');
set @a6 = ST_MPolyFromText('MULTIPOLYGON(((0 0,10 0,10 10,0 10,0 0)),((5 5,7 5,7 7,5 7,5 5)))');
set @a7 = ST_GeomFromText('GEOMETRYCOLLECTION(POINT(10 10),LINESTRING(1 1,2 2,3 3,4 4))');
set @a8 = ST_GeomFromText('GEOMETRYCOLLECTION(POINT(10 10),POINT(30 30),LINESTRING(15 15,20 20))');

insert into t1 value(1,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7);
insert into t1 value(2,null,null,null,null,null,null,null,null,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7);

select id,ST_AsText(geom),ST_AsText(poin),ST_AsText(line),ST_AsText(poly),ST_AsText(mpoin),ST_AsText(mline),ST_AsText(mploy),ST_AsText(geocol) from t1 order by id;

select id,ST_AsText(geom1),ST_AsText(line1),ST_AsText(poly1),ST_AsText(mpoin1),ST_AsText(mline1),ST_AsText(mploy1),ST_AsText(geocol1) from t1 order by id;

# change field name success   
alter table t1 change geom newgeom geometry null;
alter table t1 change poin newpoin  point null;
alter table t1 change line newline linestring null;
alter table t1 change poly newpoly polygon null;
alter table t1 change mpoin newmpoin multipoint null;
alter table t1 change mline newmline multilinestring null;
alter table t1 change mploy newmploy multipolygon null;
alter table t1 change geocol newgeocol geometrycollection null;

show create table t1;

# SEQUOIASQLMAINSTREAM-824
# change null to not null( set sql_mode = 'STRICT_TRANS_TABLES'; set sql_mode = '' )
--error 1138
alter table t1 modify newgeom geometry not null,algorithm=inplace;
--error 1138
alter table t1 modify newpoin point not null,algorithm=inplace;
--error 1138
alter table t1 modify newline linestring not null,algorithm=inplace;
--error 1138
alter table t1 modify newpoly polygon not null,algorithm=inplace;
--error 1138
alter table t1 modify newmpoin multipoint not null,algorithm=inplace;
--error 1138
alter table t1 modify newmline multilinestring not null,algorithm=inplace;
--error 1138
alter table t1 modify newmploy multipolygon not null,algorithm=inplace;
--error 1138
alter table t1 modify newgeocol geometrycollection not null,algorithm=inplace;

show create table t1;

set sql_mode = "";
--error 1846
alter table t1 modify newgeom geometry not null,algorithm=inplace;
--error 1846
alter table t1 modify newpoin point not null,algorithm=inplace;
--error 1846
alter table t1 modify newline linestring not null,algorithm=inplace;
--error 1846
alter table t1 modify newpoly polygon not null,algorithm=inplace;
--error 1846
alter table t1 modify newmpoin multipoint not null,algorithm=inplace;
--error 1846
alter table t1 modify newmline multilinestring not null,algorithm=inplace;
--error 1846
alter table t1 modify newmploy multipolygon not null,algorithm=inplace;
--error 1846
alter table t1 modify newgeocol geometrycollection not null,algorithm=inplace;
set sql_mode = default;

show create table t1;

delete from t1 where id = 2 ;

select id,ST_AsText(geom1),ST_AsText(line1),ST_AsText(poly1),ST_AsText(mpoin1),ST_AsText(mline1),ST_AsText(mploy1),ST_AsText(geocol1) from t1 order by id;

alter table t1 modify newgeom geometry not null,algorithm=inplace;
alter table t1 modify newpoin point not null,algorithm=inplace;
alter table t1 modify newline linestring not null,algorithm=inplace;
alter table t1 modify newpoly polygon not null,algorithm=inplace;
alter table t1 modify newmpoin multipoint not null,algorithm=inplace;
alter table t1 modify newmline multilinestring not null,algorithm=inplace;
alter table t1 modify newmploy multipolygon not null,algorithm=inplace;
alter table t1 modify newgeocol geometrycollection not null,algorithm=inplace;

alter table t1 modify geom1 geometry null,algorithm=inplace;
alter table t1 modify poin1 point null,algorithm=inplace;
alter table t1 modify line1 linestring null,algorithm=inplace;
alter table t1 modify poly1 polygon null,algorithm=inplace;
alter table t1 modify mpoin1 multipoint null,algorithm=inplace;
alter table t1 modify mline1 multilinestring null,algorithm=inplace;
alter table t1 modify mploy1 multipolygon null,algorithm=inplace;
alter table t1 modify geocol1 geometrycollection null,algorithm=inplace;

show create table t1;

--error 1048
insert into t1 value(2,null,@a1,@a2,@a3,@a4,@a5,@a6,@a7,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7);
--error 1048
insert into t1 value(3,@a1,null,@a2,@a3,@a4,@a5,@a6,@a7,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7);
--error 1048
insert into t1 value(4,@a1,@a1,null,@a3,@a4,@a5,@a6,@a7,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7);
--error 1048
insert into t1 value(5,@a1,@a1,@a2,null,@a4,@a5,@a6,@a7,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7);
--error 1048
insert into t1 value(6,@a1,@a1,@a2,@a3,null,@a5,@a6,@a7,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7);
--error 1048
insert into t1 value(7,@a1,@a1,@a2,@a3,@a4,null,@a6,@a7,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7);
--error 1048
insert into t1 value(8,@a1,@a1,@a2,@a3,@a4,@a5,null,@a7,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7);
--error 1048
insert into t1 value(9,@a1,@a1,@a2,@a3,@a4,@a5,@a6,null,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7);

insert into t1 value(10,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7,null,null,null,null,null,null,null,null);
insert into t1 value(11,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7);

select id,ST_AsText(geom1),ST_AsText(line1),ST_AsText(poly1),ST_AsText(mpoin1),ST_AsText(mline1),ST_AsText(mploy1),ST_AsText(geocol1) from t1 order by id;

alter table t1 drop column newgeom;
alter table t1 drop column newpoin;
alter table t1 drop column newline;
alter table t1 drop column newpoly;
alter table t1 drop column newmpoin;
alter table t1 drop column newmline;
alter table t1 drop column newmploy;
alter table t1 drop column newgeocol;

show create table t1;

select id,ST_AsText(geom1),ST_AsText(line1),ST_AsText(poly1),ST_AsText(mpoin1),ST_AsText(mline1),ST_AsText(mploy1),ST_AsText(geocol1) from t1 order by id;
drop table t1;

# seqDB-22787:  geometry type field  change basic type field 
create table `t1` (
  id int not null auto_increment primary key,
  `a1` geometry DEFAULT NULL,
  `a2` geometry DEFAULT NULL,
  `a3` geometry DEFAULT NULL,
  `a4` geometry DEFAULT NULL,
  `a5` geometry DEFAULT NULL,
  `a6` geometry DEFAULT NULL,
  `a7` geometry DEFAULT NULL,
  `a8` geometry DEFAULT NULL,
  `a9` geometry DEFAULT NULL,
  `a10` geometry DEFAULT NULL,
  `a11` geometry DEFAULT NULL,
  `a12` geometry DEFAULT NULL,
  `a13` geometry DEFAULT NULL,
  `a14` geometry DEFAULT NULL,
  `a15` geometry DEFAULT NULL,
  `a16` geometry DEFAULT NULL
);
show create table t1;

set @a1 = ST_PointFromText('POINT(1 1)');
set @a2 = ST_LineFromText('LINESTRING(0 0,10 10,20 25,50 60)');
set @a3 = ST_PolygonFromText('POLYGON((0 0,10 0,10 10,0 10,0 0),(5 5,7 5,7 7,5 7,5 5))');
set @a4 = ST_MultiPointFromText('MULTIPOINT(10 10,20 20)');
set @a5 = ST_MLineFromText('MULTILINESTRING((10 10,20 20),(15 15,30 15))');
set @a6 = ST_MPolyFromText('MULTIPOLYGON(((0 0,10 0,10 10,0 10,0 0)),((5 5,7 5,7 7,5 7,5 5)))');
set @a7 = ST_GeomFromText('GEOMETRYCOLLECTION(POINT(10 10),LINESTRING(1 1,2 2,3 3,4 4))');
set @a8 = ST_GeomFromText('GEOMETRYCOLLECTION(POINT(10 10),POINT(30 30),LINESTRING(15 15,20 20))');

insert into t1 value(10,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7);

# cover change basic 
--error 1846
alter table t1 modify a1 bool null,algorithm=inplace;
--error 1846
alter table t1 modify a2 tinyint null,algorithm=inplace;
--error 1846
alter table t1 modify a3 int null,algorithm=inplace;
--error 1846
alter table t1 modify a4 float null,algorithm=inplace;
--error 1846
alter table t1 modify a5 double null,algorithm=inplace;
--error 1846
alter table t1 modify a6 decimal null,algorithm=inplace;
--error 1846
alter table t1 modify a7 char null,algorithm=inplace;
--error 1846
alter table t1 modify a8 tinyblob null,algorithm=inplace;
--error 1846
alter table t1 modify a9 bit null,algorithm=inplace;
--error 1846
alter table t1 modify a10 date null,algorithm=inplace;
--error 1846
alter table t1 modify a11 tinytext null,algorithm=inplace;
--error 1846
alter table t1 modify a12 text null,algorithm=inplace;
#BUG SEQUOIASQLMAINSTREAM-823
--error 1846
alter table t1 modify a13 longblob null,algorithm=inplace;
--error 1846
alter table t1 modify a14 timestamp null,algorithm=inplace;

drop table t1;

#  seqDB-22787:basic  type field  change geometry type field 
create table `t1` (
  id int not null auto_increment primary key,
  `a1` bool ,
  `a2` tinyint ,
  `a3` smallint ,
  `a4` int ,
  `a5` bigint ,
  `a6` float ,
  `a7` double ,
  `a8` decimal ,
  `a9` char,
  `a12` bit ,
  `a13` year,
  `a14` time ,
  `a15` date ,
  `a16` datetime ,
  `a17` tinytext ,
  `a18` text ,
  `a19` mediumText ,
  `a20` longtext ,
  `a21` tinyblob ,
  `a22` mediumblob, 
  `a23` longblob ,
  `a24` timestamp 
);
show create table t1;
--error 1846
alter table t1 modify a1 geometry,algorithm=inplace;
--error 1846
alter table t1 modify a2 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a3 geometry,algorithm=inplace;
--error 1846
alter table t1 modify a4 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a5 geometry,algorithm=inplace;
--error 1846
alter table t1 modify a6 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a7 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a8 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a9 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a12 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a13 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a14 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a15 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a16 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a17 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a18 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a19 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a20 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a24 geometry ,algorithm=inplace;

#BUG SEQUOIASQLMAINSTREAM-823
--error 1846
alter table t1 modify a21 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a22 geometry ,algorithm=inplace;
--error 1846
alter table t1 modify a23 geometry ,algorithm=inplace;
show create table t1;
drop table t1;

#  seqDB-22787:geometry type field  change geometry type field 
create table `t1` (
  id int not null auto_increment primary key,
  `geom` geometry DEFAULT NULL,
  `poin` geometry DEFAULT NULL,
  `line` geometry DEFAULT NULL,
  `poly` geometry DEFAULT NULL,
  `mpoin` geometry DEFAULT NULL,
  `mline` geometry DEFAULT NULL,
  `mploy` geometry DEFAULT NULL,
  `geocol` geometry DEFAULT NULL,
  `geom1` geometry DEFAULT NULL,
  `poin1` point  DEFAULT NULL,
  `line1` linestring DEFAULT NULL,
  `poly1` polygon  DEFAULT NULL,
  `mpoin1` multipoint  DEFAULT NULL,
  `mline1` multilinestring DEFAULT NULL,
  `mploy1` multipolygon DEFAULT NULL,
  `geocol1` geometrycollection DEFAULT NULL
);

insert into t1 value(10,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7,@a1,@a1,@a2,@a3,@a4,@a5,@a6,@a7);

show create table t1;

--error 1846
alter table t1 modify poin point null,algorithm=inplace;
--error 1846
alter table t1 modify line linestring null,algorithm=inplace;
--error 1846
alter table t1 modify poly polygon null,algorithm=inplace;
--error 1846
alter table t1 modify mpoin multipoint null,algorithm=inplace;
--error 1846
alter table t1 modify mline multilinestring null,algorithm=inplace;
--error 1846
alter table t1 modify mploy multipolygon null,algorithm=inplace;
--error 1846
alter table t1 modify geocol geometrycollection null,algorithm=inplace;
--error 1846
alter table t1 modify poin1 geometry null,algorithm=inplace;

show create table t1;

select id,ST_AsText(geom),ST_AsText(poin),ST_AsText(line),ST_AsText(poly),ST_AsText(mpoin),ST_AsText(mline),ST_AsText(mploy),ST_AsText(geocol) from t1 order by id;

select id,ST_AsText(geom1),ST_AsText(line1),ST_AsText(poly1),ST_AsText(mpoin1),ST_AsText(mline1),ST_AsText(mploy1),ST_AsText(geocol1) from t1 order by id;
drop table t1;

# seqDB-22789:create index in geometry type
--error 138
create table t1(id int,g geometry,index(g(128)));
create table t1(id int,g geometry);
show create table t1;
--error 138
create index geoindex on t1 (g(128));
drop table t1;

drop database test_alter;
--source include/uninstall_sequoiadb.inc
