#check auto increment 
#Case 18247#Case 18248#Case 18249#Case 18287#Case 18288#Case 18289#Case 18290
#Case 18291#Case 18292#Case 18293#Case 18294#Case 18295#Case 18296#Case 18297
#Case 18328#Case 18393#Case 18399#Case 20320#Case 20408#Case 22119#Case 22229 
#Case 24413

--source include/have_sequoiadb.inc

CREATE DATABASE test_auto_increment;
use test_auto_increment;
--disable_query_log
create table reserved(a int primary key)ENGINE=sequoiadb COMMENT='sequoiadb:{ auto_partition: true }';
--enable_query_log

--disable_warnings
DROP TABLE IF EXISTS t1,t2;
--enable_warnings

# check auto_increment attribute
CREATE TABLE t1(a BIGINT NOT NULL AUTO_INCREMENT, b CHAR(16), PRIMARY KEY(a));
CREATE TABLE t2(a INT NOT NULL AUTO_INCREMENT, b CHAR(16), PRIMARY KEY(a)) AUTO_INCREMENT = 100;
SHOW CREATE TABLE t1;
SHOW CREATE TABLE t2;
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't2';
DROP TABLE t1,t2;

# insert normal records
CREATE TABLE t1(a TINYINT NOT NULL AUTO_INCREMENT, UNIQUE KEY(a));
INSERT INTO t1 VALUES ();
#BUG #SEQUOIADBMAINSTREAM-4391
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
INSERT INTO t1 VALUES (0),(10),(-1),(3.5),(7.1);
#BUG #SEQUOIADBMAINSTREAM-4391
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
INSERT INTO t1 VALUES (NULL);
#BUG #SEQUOIADBMAINSTREAM-4391
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
SET sql_mode = 'NO_AUTO_VALUE_ON_ZERO';
INSERT INTO t1 VALUES (0);
#BUG #SEQUOIADBMAINSTREAM-4391
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
INSERT INTO t1 VALUES (100),(101),(102);
#BUG #SEQUOIADBMAINSTREAM-4391
SHOW CREATE TABLE t1;
INSERT INTO t1 VALUES (NULL);
#BUG #SEQUOIADBMAINSTREAM-4391
SHOW CREATE TABLE t1;
SELECT * FROM t1;
DROP TABLE t1;

# insert duplicate records
SET sql_mode = default;
CREATE TABLE t1(id SMALLINT NOT NULL AUTO_INCREMENT, a SMALLINT, PRIMARY KEY(id), UNIQUE KEY(a));
INSERT INTO t1(a) VALUES (1),(2),(3),(4),(5);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
# SEQUOIASQLMAINSTREAM-171
--error 1062
INSERT INTO t1 values (3,-1);
INSERT INTO t1(a) values (6);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1 ORDER BY id;
# SEQUOIASQLMAINSTREAM-171
--error 1062
INSERT INTO t1(a) values (10),(5),(11),(12);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1 ORDER BY id;
INSERT INTO t1(a) values (7);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1 ORDER BY id;
DROP TABLE t1;

# update normal records
CREATE TABLE t1(a MEDIUMINT NOT NULL AUTO_INCREMENT, UNIQUE KEY(a));
INSERT INTO t1 VALUES (),(),();
UPDATE t1 SET a = 4 WHERE a = 3;
#BUG #SEQUOIASQLMAINSTREAM-249 
#INSERT INTO t1 VALUES (3);
INSERT INTO t1 VALUES (20);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
UPDATE t1 SET a = 10 WHERE a = 20;
INSERT INTO t1 VALUES ();
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
DROP TABLE t1;

# update duplicate records
CREATE TABLE t1(id INT NOT NULL AUTO_INCREMENT, a INT, PRIMARY KEY(id), UNIQUE KEY(a));
INSERT INTO t1(a) VALUES (1),(2),(3);
INSERT INTO t1 VALUES (11,11);
# SEQUOIASQLMAINSTREAM-171
--error 1062
UPDATE t1 SET id = 3 WHERE id = 11;
INSERT INTO t1(a) VALUES (12);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1 ORDER BY id;
--error 1062
UPDATE t1 SET a = 3 WHERE a = 11;
INSERT INTO t1(a) VALUES (13);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1 ORDER BY id;
DROP TABLE t1;

# replace
CREATE TABLE t1(a INT NOT NULL AUTO_INCREMENT, b CHAR(8), PRIMARY KEY(a));
INSERT INTO t1(b) VALUES ('a'),('b'),('c');
REPLACE INTO t1 VALUES (6, 'x'),(8, 'y');
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
REPLACE INTO t1 VALUES (1, 'a111'),(3, 'c333');
INSERT INTO t1 VALUES ();
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
DROP TABLE t1;

# update ignore
CREATE TABLE t1(a INT NOT NULL AUTO_INCREMENT, UNIQUE KEY(a));
INSERT INTO t1 VALUES (),(),();
INSERT INTO t1 VALUES (10);
UPDATE IGNORE t1 SET a = 3 WHERE a = 10;
# SEQUOIASQLMAINSTREAM-171
SHOW WARNINGS;
INSERT INTO t1 VALUES ();
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
UPDATE IGNORE t1 SET a = 4 WHERE a = 10;
INSERT INTO t1 VALUES (10);
INSERT INTO t1 VALUES ();
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
DROP TABLE t1;

# insert .. on duplicate key update
CREATE TABLE t1(a BIGINT NOT NULL AUTO_INCREMENT, b CHAR(8), UNIQUE KEY(a));
INSERT INTO t1(b) VALUES ('aaa'),('bbb'),('ccc');
INSERT INTO t1 VALUES (6,'xxx'), (7,'yyy') ON DUPLICATE KEY UPDATE a = 3;
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
# SEQUOIASQLMAINSTREAM-112
--error 1062
INSERT INTO t1 VALUES (2,'newbbb') ON DUPLICATE KEY UPDATE a = 3;
INSERT INTO t1 VALUES ();
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
DROP TABLE t1;

# assign values to insert
CREATE TABLE t1(a BIGINT NOT NULL AUTO_INCREMENT,  PRIMARY KEY(a));
INSERT INTO t1 VALUES (),();
INSERT INTO t1 VALUES (11);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
INSERT INTO t1 VALUES (101),(90),(121),(99),(100);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
INSERT INTO t1 VALUES (10);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
INSERT INTO t1 VALUES (5),(6);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
DROP TABLE t1;

# insert oversize
CREATE TABLE t1(a TINYINT NOT NULL AUTO_INCREMENT,  PRIMARY KEY(a));
CREATE TABLE t2(a TINYINT NOT NULL AUTO_INCREMENT,  KEY(a));
INSERT INTO t1 VALUES (),();
INSERT INTO t2 VALUES (),();
INSERT INTO t1 VALUES (127);
INSERT INTO t2 VALUES (127);
--error 1467 
INSERT INTO t1 VALUES ();
--error 1467 
INSERT INTO t2 VALUES ();
DROP TABLE t1,t2;

# create common index
CREATE TABLE t1(a TINYINT NOT NULL AUTO_INCREMENT,  KEY(a));
CREATE TABLE t2(a SMALLINT NOT NULL AUTO_INCREMENT,  KEY(a));
CREATE TABLE t3(a MEDIUMINT NOT NULL AUTO_INCREMENT,  KEY(a));
CREATE TABLE t4(a INT NOT NULL AUTO_INCREMENT,  KEY(a));
CREATE TABLE t5(a BIGINT NOT NULL AUTO_INCREMENT,  KEY(a));
INSERT INTO t1 VALUES (),(),();
INSERT INTO t1 VALUES (1),(2);
INSERT INTO t2 VALUES (),(),();
INSERT INTO t2 VALUES (1),(2);
INSERT INTO t3 VALUES (),(),();
INSERT INTO t3 VALUES (1),(2);
INSERT INTO t4 VALUES (),(),();
INSERT INTO t4 VALUES (1),(2);
INSERT INTO t5 VALUES (),(),();
INSERT INTO t5 VALUES (1),(2);
#BUG #SEQUOIADBMAINSTREAM-4391
#SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't2';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't3';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't4';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't5';
SELECT * FROM t1;
SELECT * FROM t2;
SELECT * FROM t3;
SELECT * FROM t4;
SELECT * FROM t5;
UPDATE t1 SET a = 1 WHERE a = 2;
UPDATE t2 SET a = 1 WHERE a = 2;
UPDATE t3 SET a = 1 WHERE a = 2;
UPDATE t4 SET a = 1 WHERE a = 2;
UPDATE t5 SET a = 1 WHERE a = 2;
INSERT INTO t1 VALUES ();
INSERT INTO t2 VALUES ();
INSERT INTO t3 VALUES ();
INSERT INTO t4 VALUES ();
INSERT INTO t5 VALUES ();
#BUG #SEQUOIADBMAINSTREAM-4391
#SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't2';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't3';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't4';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't5';
SELECT * FROM t1; 
SELECT * FROM t2; 
SELECT * FROM t3; 
SELECT * FROM t4; 
SELECT * FROM t5; 
REPLACE INTO t1 VALUES (1),(2),(6),(9);
REPLACE INTO t2 VALUES (1),(2),(6),(9);
REPLACE INTO t3 VALUES (1),(2),(6),(9);
REPLACE INTO t4 VALUES (1),(2),(6),(9);
REPLACE INTO t5 VALUES (1),(2),(6),(9);
#BUG #SEQUOIADBMAINSTREAM-4391
#SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't2';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't3';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't4';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't5';
SELECT * FROM t1;
SELECT * FROM t2;
SELECT * FROM t3;
SELECT * FROM t4;
SELECT * FROM t5;
INSERT INTO t1 VALUES (6), (7) ON DUPLICATE KEY UPDATE a = 1;
INSERT INTO t1 VALUES (6), (7) ON DUPLICATE KEY UPDATE a = 1;
INSERT INTO t1 VALUES (6), (7) ON DUPLICATE KEY UPDATE a = 1;
INSERT INTO t1 VALUES (6), (7) ON DUPLICATE KEY UPDATE a = 1;
INSERT INTO t1 VALUES (6), (7) ON DUPLICATE KEY UPDATE a = 1;
#BUG #SEQUOIADBMAINSTREAM-4391
#SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't2';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't3';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't4';
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't5';
SELECT * FROM t1;
SELECT * FROM t2;
SELECT * FROM t3;
SELECT * FROM t4;
SELECT * FROM t5;
DELETE FROM t1 WHERE a = 1;
DELETE FROM t2 WHERE a = 6;
DELETE FROM t3 WHERE a = 7;
DELETE FROM t4 WHERE a = 9;
DELETE FROM t5 WHERE a = 11;
SELECT * FROM t1;         
SELECT * FROM t2;
SELECT * FROM t3; 
SELECT * FROM t4;
SELECT * FROM t5;
DROP TABLE t1,t2,t3,t4,t5;

# check float
CREATE TABLE t1(a FLOAT NOT NULL AUTO_INCREMENT, PRIMARY KEY(a));
INSERT INTO t1 VALUES ();
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
INSERT INTO t1 VALUES (1.1);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
INSERT INTO t1 VALUES (3),(5),(7);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
INSERT INTO t1 VALUES (10),(2.2);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1;
DROP TABLE t1;

# check LAST_INSERT_ID
CREATE TABLE t1(a INT NOT NULL AUTO_INCREMENT, b CHAR(16), PRIMARY KEY(a));
CREATE TABLE t2(a INT NOT NULL AUTO_INCREMENT, PRIMARY KEY(a));
SELECT LAST_INSERT_ID();
INSERT INTO t1 VALUES ();
SELECT LAST_INSERT_ID();    
INSERT INTO t1 VALUES (),(),();
SELECT LAST_INSERT_ID(); 
INSERT INTO t2 VALUES ();
SELECT LAST_INSERT_ID();
INSERT INTO t1 VALUES ();
SELECT LAST_INSERT_ID();
#BUG #SEQUOIASQLMAINSTREAM-171
--error 1062
INSERT INTO t1 VALUES (10, 'a'), (1, 'b'), (11, 'c');
SELECT LAST_INSERT_ID();
DROP TABLE t1;
DROP TABLE t2;

# check LAST_INSERT_ID(expr)
CREATE TABLE t1(a INT NOT NULL);
INSERT INTO t1 VALUES (0),(1),(2),(4),(6),(8),(12);
SELECT * FROM t1;
UPDATE t1 SET a = LAST_INSERT_ID(a + 1);
SELECT LAST_INSERT_ID();
SELECT * FROM t1;
DELETE FROM t1 WHERE 1 = LAST_INSERT_ID(a - 6);
select LAST_INSERT_ID();
SELECT * FROM t1;
DROP TABLE t1;

#SEQUOIASQLMAINSTREAM-283
# normal insert/update/delete
SET sql_mode = default;
CREATE TABLE t1(a SMALLINT NOT NULL AUTO_INCREMENT, b INT, PRIMARY KEY(b,a));
INSERT INTO t1 VALUES (NULL,1),(NULL,1),(NULL,1),(NULL,2),(NULL,1);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
--sorted_result
SELECT * FROM t1;
UPDATE t1 SET a = 6 WHERE a = 5;
#BUG #SEQUOIASQLMAINSTREAM-249
#INSERT INTO t1 VALUES (5,1);
INSERT INTO t1 VALUES (20,3);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
--sorted_result
SELECT * FROM t1;
UPDATE t1 SET a = 10 WHERE a = 20;
INSERT INTO t1 VALUES (NULL,3);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
--sorted_result
SELECT * FROM t1; 
DELETE FROM t1 WHERE a > 5;
--sorted_result
SELECT * FROM t1; 
DROP TABLE t1; 

#SEQUOIASQLMAINSTREAM-283
# create common index
CREATE TABLE t1(a TINYINT NOT NULL AUTO_INCREMENT, b CHAR(8), c INT, KEY(b,a));
INSERT INTO t1 VALUES (NULL,'aaa',1),(NULL,'bbb',3),(NULL,'aaa',2),(NULL,'ccc',1);
#SEQUOIADBMAINSTREAM-4391
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
--sorted_result
SELECT * FROM t1;
UPDATE t1 SET a = 1 WHERE a = 3;
INSERT INTO t1 VALUES (NULL,'aaa',3);
#SEQUOIADBMAINSTREAM-4391
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
--sorted_result
SELECT * FROM t1;
REPLACE INTO t1 VALUES (1,'aaa',11),(2,'bbb',14),(10,'ddd',11);
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
--sorted_result
SELECT * FROM t1;
INSERT INTO t1 VALUES (1,'aaa',11) ON DUPLICATE KEY UPDATE a = 3;
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
--sorted_result
SELECT * FROM t1;
DELETE FROM t1 WHERE a = 1;
--sorted_result
SELECT * FROM t1;
DROP TABLE t1;

#SEQUOIASQLMAINSTREAM-529
CREATE TABLE t1 ( a BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY );
INSERT INTO t1 VALUES (9223372036854775807);
SHOW CREATE TABLE t1;
SELECT * FROM t1;
--error 1467
INSERT INTO t1 VALUES (9223372036854775808);
--error 1467 
INSERT INTO t1 VALUES (NULL);
SELECT * FROM t1;
DROP TABLE t1;

#SEQUOIASQLMAINSTREAM-530
create table t1 (a smallint primary key auto_increment);
--error 1467
insert ignore into t1 values(32766),(NULL),(NULL),(1);
select * from t1;
truncate table t1;

set @org_mode=@@sql_mode;
set @@sql_mode='ansi,traditional';
--error 1467
insert ignore into t1 values(32766),(NULL),(NULL);
truncate table t1;
--error 1467
insert into t1 values(32766),(NULL),(NULL);
set @@sql_mode=@org_mode;
drop table t1;

#seqDB-22119
CREATE TABLE t1(id INT NOT NULL AUTO_INCREMENT, UNIQUE KEY(id));
INSERT INTO t1 VALUES (),(),();
UPDATE t1 SET id = 4 where id = 3;
INSERT INTO t1 VALUES ();
SELECT AUTO_INCREMENT FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test_auto_increment' AND TABLE_NAME = 't1';
SELECT * FROM t1 ORDER BY id;
DROP TABLE t1;

#seqDB-22229
CREATE TABLE t1 (
  c1 INT NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (c1))
ENGINE=sequoiadb;
INSERT INTO t1 VALUES (2);
INSERT INTO t1 VALUES (4);
SET INSERT_ID = 30;
INSERT INTO t1 VALUES (NULL);
SELECT * FROM t1 ORDER BY c1;
SET INSERT_ID = -1;
INSERT INTO t1 VALUES (NULL);
SELECT * FROM t1 ORDER BY c1;
SET INSERT_ID = 0;
INSERT INTO t1 VALUES (NULL);
SELECT * FROM t1 ORDER BY c1;
SET INSERT_ID = 2147483647;
INSERT INTO t1 VALUES (NULL);
SELECT * FROM t1 ORDER BY c1;
SET INSERT_ID = 2147483648;
--error 1264
INSERT INTO t1 VALUES (NULL);
SELECT * FROM t1 ORDER BY c1;
DROP TABLE t1;

# seqDB-24413
CREATE TABLE t1(a INT AUTO_INCREMENT KEY)COMMENT='sequoiadb:{auto_partition:false}';
INSERT INTO t1 VALUES(),(),();
SELECT * FROM t1;
ALTER TABLE t1 AUTO_INCREMENT = 2002;
INSERT INTO t1 VALUES(),(),();
SELECT * FROM t1;
ALTER TABLE t1 CHANGE a col1 INT AUTO_INCREMENT;
INSERT INTO t1 VALUES(),(),();
SELECT * FROM t1;
DROP TABLE t1;

DROP DATABASE test_auto_increment;
--source include/uninstall_sequoiadb.inc
