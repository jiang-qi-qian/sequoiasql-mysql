--source include/have_partition.inc

CREATE DATABASE partition_exchange;
use partition_exchange;

--echo #
--echo # Bug#11894100: EXCHANGE PARTITION CAN'T BE EXECUTED IF
--echo #               ROW_FORMAT WAS SET EXPLICITLY
--echo #

--echo # Same definition (both have ROW_FORMAT set)
# SEQUOIASQLMAINSTREAM-1105
# failed: 1818: Supports only YEAR or YEAR(4) column
--error 1818
CREATE TABLE t1 (
 id int(11) NOT NULL AUTO_INCREMENT,
 year year(2) DEFAULT NULL,
 modified timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
 PRIMARY KEY (id)
) ENGINE=SequoiaDB ROW_FORMAT=COMPACT
PARTITION BY HASH (id)
PARTITIONS 2;

CREATE TABLE t1 (
 id int(11) NOT NULL AUTO_INCREMENT,
 year year(4) DEFAULT NULL,
 modified timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
 PRIMARY KEY (id)
) ENGINE=SequoiaDB ROW_FORMAT=COMPACT
PARTITION BY HASH (id)
PARTITIONS 2;

CREATE TABLE t2 LIKE t1;
ALTER TABLE t2 REMOVE PARTITIONING;

--vertical_results
SHOW CREATE TABLE t1;
SHOW CREATE TABLE t2;

SELECT TABLE_NAME, TABLE_TYPE, ENGINE, ROW_FORMAT, CREATE_OPTIONS
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'partition_exchange' AND TABLE_NAME IN ('t1', 't2')
ORDER BY TABLE_NAME;

# SEQUOIASQLMAINSTREAM-1106
# failed with wrong errno 1505: 'Partition management on a not partitioned table is not possible'
--error 1505
ALTER TABLE t1 EXCHANGE PARTITION p1 WITH TABLE t2;
SHOW CREATE TABLE t1;
SHOW CREATE TABLE t2;
SELECT TABLE_NAME, TABLE_TYPE, ENGINE, ROW_FORMAT, CREATE_OPTIONS
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'partition_exchange' AND TABLE_NAME IN ('t1', 't2')
ORDER BY TABLE_NAME;

DROP TABLE t1, t2;

DROP DATABASE partition_exchange;
