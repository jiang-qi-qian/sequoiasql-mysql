#seqDB-28031 多表关联查询时带有子查询
--source include/have_sequoiadb.inc
--disable_warnings
drop database if exists explain_remove_order_by_28031;
--enable_warnings
create database explain_remove_order_by_28031;
drop database explain_remove_order_by_28031;
create database explain_remove_order_by_28031;

use explain_remove_order_by_28031;
set session sequoiadb_debug_log=on;
--disable_warnings
drop table if exists t1,t2;
--enable_warnings
create table t1(
	col1 int,
	col2 varchar(10),
	col3 char(10),
	col4 decimal(5,2),
	col5 float(5,2),
	col6 double(3,2),
	col7 datetime,
	col8 varchar(10),
	key idx_col1(col1),
	key idx_col2(col2),
	key idx_col3(col3),
	key idx_col4(col4),
	key idx_col5(col5),
	key idx_col6(col6),
	key idx_col7(col7),
	key idx_col12(col1,col2)
);
INSERT INTO t1 VALUES (320,'6c782c','f90a05',642.63,564.23,8.93,'2022-09-23 16:17:33','b3ec0e'),(621,'ddd753','c3218f',568.59,329.39,9.41,'2022-09-23 16:17:28','299803'),(672,'bbbbff','d4b326',339.68,778.59,8.74,'2022-09-23 16:16:19','99daa7'),(633,'44f333','f732ae',54.88,96.32,3.17,'2022-09-23 16:16:46','8b4af7'),(753,'e44027','e5e55b',677.44,455.81,2.47,'2022-09-23 16:17:43','3a6ca9'),(354,'b06bb7','659668',654.65,483.42,4.53,'2022-09-23 16:17:38','29cd07'),(144,'bb3dd0','b9308b',257.88,119.06,8.22,'2022-09-23 16:17:31','191f0e'),(200,'af46f0','7dcdad',805.32,914.05,1.54,'2022-09-23 16:16:19','cf3034'),(328,'255bb8','d05150',68.73,439.80,9.93,'2022-09-23 16:17:20','f7818e'),(291,'2f2517','7d407e',453.24,100.33,1.42,'2022-09-23 16:16:57','88a93f'),(864,'fa1259','7b4d9b',275.66,175.62,0.51,'2022-09-23 16:17:29','56f931'),(267,'b2fe40','daf06a',976.32,342.83,7.85,'2022-09-23 16:17:46','c4f64c'),(968,'ab343f','97800d',239.21,254.03,5.53,'2022-09-23 16:16:16','eb950b'),(725,'8071f5','5fb2d3',92.48,145.76,4.51,'2022-09-23 16:17:38','5008dc'),(258,'227b2a','e05ef2',444.19,647.07,9.03,'2022-09-23 16:17:13','45c70e'),(55,'1c2555','568498',24.48,447.31,1.63,'2022-09-23 16:17:03','645bd5'),(973,'a1c280','b09a0d',402.58,362.96,6.07,'2022-09-23 16:17:51','8450ad'),(716,'9fec7e','fe98ea',882.10,157.70,1.42,'2022-09-23 16:16:40','381094'),(104,'e0b316','c29b7a',461.89,821.71,7.23,'2022-09-23 16:16:31','1d14e8'),(441,'c1b6a7','e32a7e',733.54,581.31,7.06,'2022-09-23 16:17:35','114801'),(697,'536140','ad783d',677.09,886.91,4.03,'2022-09-23 16:16:52','f4de0d'),(776,'0f72c5','079ae9',177.21,267.64,8.07,'2022-09-23 16:16:39','ab3153'),(957,'d267eb','8b6cc7',801.60,650.32,8.47,'2022-09-23 16:16:45','849bef'),(524,'014f05','b37d85',56.22,54.22,1.02,'2022-09-23 16:16:52','842c71'),(154,'6e8882','352203',522.47,294.88,9.07,'2022-09-23 16:17:22','5ec9a0'),(701,'d1c3da','f909c8',595.74,575.79,0.92,'2022-09-23 16:17:30','96d331'),(710,'28a036','e8d294',329.56,915.31,5.88,'2022-09-23 16:16:36','dc44d7'),(434,'aa86f4','35a4d9',882.03,866.54,6.87,'2022-09-23 16:17:40','8ac629'),(36,'e89aa7','7581d9',369.17,276.81,2.77,'2022-09-23 16:17:12','fd2c61'),(3,'d74ebd','9c36e0',797.54,712.59,1.70,'2022-09-23 16:17:28','cfe83a'),(149,'92fe8e','fe0ece',345.60,490.94,4.18,'2022-09-23 16:17:19','bd2c56'),(298,'4c2081','428225',559.68,460.14,6.22,'2022-09-23 16:17:30','f7237b'),(686,'9b9f9d','9df11c',115.16,109.63,2.03,'2022-09-23 16:17:25','929260'),(18,'5a2dd9','118178',967.06,290.21,5.50,'2022-09-23 16:17:45','a7cb17'),(85,'ec1c4d','a5f308',931.91,556.53,9.87,'2022-09-23 16:16:44','fdd07d'),(28,'60b18e','611339',567.42,416.24,3.79,'2022-09-23 16:17:22','d5f7d9'),(527,'2bc499','299aea',930.36,52.48,4.71,'2022-09-23 16:16:37','6b1905'),(311,'2f6584','cdc668',185.78,556.45,2.25,'2022-09-23 16:17:03','af7c20'),(641,'b1aeaf','4a83a4',168.47,623.20,6.11,'2022-09-23 16:16:35','0a2545'),(875,'d43b6e','5b6f47',546.41,785.14,2.86,'2022-09-23 16:16:25','dd25c9'),(395,'0a2fa3','4810b7',828.17,728.37,1.57,'2022-09-23 16:17:17','0d7795'),(875,'f268a7','f99176',768.55,199.17,6.90,'2022-09-23 16:17:42','9ce1a4'),(422,'245c2c','accd99',87.25,450.36,9.90,'2022-09-23 16:17:17','cb2f7b'),(331,'bb8fee','dba99a',733.78,989.87,7.48,'2022-09-23 16:17:34','2c238d'),(731,'5325c1','abe841',256.57,438.46,4.23,'2022-09-23 16:17:37','356e3d'),(209,'5bdbcc','b4c37f',329.80,258.25,3.02,'2022-09-23 16:17:30','b9d6f9'),(631,'c152b1','ee7ede',340.33,558.66,7.72,'2022-09-23 16:16:36','0d56e8'),(499,'2db783','52146f',53.42,845.76,0.69,'2022-09-23 16:17:38','7f24f7'),(690,'7acde8','6af783',357.28,195.87,9.07,'2022-09-23 16:17:52','58f6ba'),(285,'019c49','036873',269.89,770.65,0.44,'2022-09-23 16:17:48','f93500'),(277,'85d53d','1c1e32',969.84,530.01,7.41,'2022-09-23 16:16:28','4688e8'),(371,'2b5a5d','61aa73',682.18,308.71,4.97,'2022-09-23 16:17:13','9c4c20'),(839,'750923','edb982',688.81,717.63,5.22,'2022-09-23 16:17:03','9b1369'),(200,'a8d1c2','06f63f',899.54,411.85,3.61,'2022-09-23 16:17:14','7f461c'),(79,'f0627f','0ee80b',614.93,876.10,5.36,'2022-09-23 16:16:22','b7deb0'),(69,'5d10f0','a49f60',82.35,815.97,8.33,'2022-09-23 16:17:29','7220e6'),(262,'599fe3','acc351',469.78,752.57,3.54,'2022-09-23 16:17:08','9a2d87'),(915,'3f81e3','227d0d',656.63,894.26,5.01,'2022-09-23 16:17:39','5e1056'),(616,'8d8eb8','62d9eb',732.32,815.49,8.81,'2022-09-23 16:17:53','2cff59'),(827,'a921a1','897012',385.20,602.98,8.59,'2022-09-23 16:17:06','8bd637'),(834,'58fd3b','c0b22b',558.66,388.26,2.65,'2022-09-23 16:16:33','cce37a'),(580,'51ab7b','7a3ec0',249.03,545.18,9.79,'2022-09-23 16:16:43','0b4a03'),(4,'1d6fbb','a78606',900.20,245.83,5.29,'2022-09-23 16:17:48','121416'),(986,'aae96c','b9076b',632.63,385.00,0.27,'2022-09-23 16:17:55','8f96c8'),(165,'74332b','69b526',477.85,451.70,8.25,'2022-09-23 16:17:34','d2e139'),(560,'920427','a2e3a7',486.99,325.34,1.66,'2022-09-23 16:17:42','bf601c'),(269,'a4ccc1','b1d3e7',85.11,82.24,1.56,'2022-09-23 16:17:10','d73948'),(379,'1329cb','d1992c',95.03,263.66,0.33,'2022-09-23 16:16:55','b38a18'),(753,'4ae161','9ce359',374.36,55.57,1.55,'2022-09-23 16:17:18','42e434'),(37,'897d82','f9eead',746.66,42.97,9.75,'2022-09-23 16:17:32','a2fb9d'),(778,'8e311e','066299',921.01,385.85,1.66,'2022-09-23 16:17:24','ddeda9'),(325,'f5beaa','0036f5',477.04,70.71,9.22,'2022-09-23 16:16:57','9f5457'),(965,'fe68e7','a49d76',289.86,249.21,3.76,'2022-09-23 16:16:30','6da28d'),(319,'5e4bbd','62118b',378.95,335.42,5.40,'2022-09-23 16:17:26','3c38cc'),(186,'28d5f5','4357f2',265.84,511.02,7.58,'2022-09-23 16:16:42','ac8a35'),(242,'85f377','076da9',915.25,655.05,5.30,'2022-09-23 16:17:25','5a3c8a'),(71,'cbec65','9a4412',373.87,254.73,1.52,'2022-09-23 16:17:57','b21ba9'),(629,'c6a51d','cadef3',219.06,128.49,9.85,'2022-09-23 16:17:11','1ae22c'),(121,'ef3baa','275a81',76.80,92.26,2.31,'2022-09-23 16:17:45','3d3c85'),(844,'d927f1','1d8842',252.43,872.92,6.07,'2022-09-23 16:16:59','163f05'),(81,'ca56d8','7c88bd',67.52,10.56,8.50,'2022-09-23 16:16:39','2fe5d8'),(76,'456b22','4e4f6d',148.10,318.60,1.49,'2022-09-23 16:17:36','d11689'),(98,'8759f6','ac505e',793.80,671.62,9.77,'2022-09-23 16:17:44','5b67f1'),(459,'a62019','5275a2',319.64,908.30,5.83,'2022-09-23 16:16:36','892549'),(397,'334d53','58b126',3.32,482.06,4.00,'2022-09-23 16:17:13','ca50ae'),(217,'81fd98','01c15c',528.57,289.22,8.60,'2022-09-23 16:17:00','b624a9'),(650,'8ed813','c9c9ac',736.84,384.57,7.12,'2022-09-23 16:16:58','1ae612'),(291,'913dc1','542eee',83.39,820.56,8.53,'2022-09-23 16:17:37','16a27e'),(845,'1e4dcb','19bd7c',557.41,279.38,7.25,'2022-09-23 16:17:36','802eaa'),(405,'e9c73d','3f0287',845.26,334.58,1.37,'2022-09-23 16:17:25','5b0e26'),(944,'7cfc4b','ec6c1b',845.91,811.99,5.22,'2022-09-23 16:16:35','6175c2'),(19,'77bc3a','96e568',398.89,654.04,0.74,'2022-09-23 16:16:58','a1629e'),(819,'ed3f31','332efa',526.87,906.48,9.52,'2022-09-23 16:16:21','964aa0'),(592,'78628e','b9ad44',652.26,590.20,9.94,'2022-09-23 16:16:37','0d6bda'),(495,'e21ee7','5e8b26',740.66,909.23,3.24,'2022-09-23 16:17:46','4aedbd'),(787,'d246a4','bd8574',213.79,320.85,9.63,'2022-09-23 16:17:42','a63146'),(299,'7a637e','421ecf',903.25,488.28,7.32,'2022-09-23 16:16:36','8896af'),(282,'3a126e','519bd8',769.83,24.17,8.11,'2022-09-23 16:17:55','2b5842'),(483,'62e3f4','76c754',723.58,668.28,1.71,'2022-09-23 16:17:42','df0767');
insert into t1 values(null,null,null,null,null,null,null,null),(101,null,null,null,null,null,null,null),(null,'35dfg7',null,null,null,null,null,null);

create table t2 like t1;
insert into t2 select * from t1 order by col1 limit 70;

#join子查询
#不带order by
explain select t1.* from t1 join (select * from t2 where col2 > '2c' and col2 < '3d') as tt2 on t1.col1 = tt2.col1;
let $query = select t1.* from t1 join (select * from t2 where col2 > '2c' and col2 < '3d') as tt2 on t1.col1 = tt2.col1;
--source include/query_without_sorted_and_get_mysqld_note_log_sequoiadb.inc

#带order by
explain select t1.* from t1 join (select * from t2 where col2 > '2c' and col2 < '3d') as tt2 on t1.col1 = tt2.col1 order by tt2.col2;
let $query = select t1.* from t1 join (select * from t2 where col2 > '2c' and col2 < '3d') as tt2 on t1.col1 = tt2.col1 order by tt2.col2;
--source include/query_without_sorted_and_get_mysqld_note_log_sequoiadb.inc
explain select t1.* from t1 join (select * from t2 where col2 > '2c' and col2 < '3d') as tt2 on t1.col1 = tt2.col1 order by tt2.col2 desc;
let $query = select t1.* from t1 join (select * from t2 where col2 > '2c' and col2 < '3d') as tt2 on t1.col1 = tt2.col1 order by tt2.col2 desc;
--source include/query_without_sorted_and_get_mysqld_note_log_sequoiadb.inc

#关联字段为多字段，子查询和外层查询同时带有order by
explain select t1.* from t1 join (select * from t2 where col2 > '2c' and col2 < '3d' order by t2.col1) as tt2 on t1.col1 = tt2.col1 and t1.col2 = tt2.col2 order by t1.col1;
let $query = select t1.* from t1 join (select * from t2 where col2 > '2c' and col2 < '3d' order by t2.col1) as tt2 on t1.col1 = tt2.col1 and t1.col2 = tt2.col2 order by t1.col1;
--source include/query_without_sorted_and_get_mysqld_note_log_sequoiadb.inc
drop table t1,t2;

set session sequoiadb_debug_log=off;
drop database explain_remove_order_by_28031;
--source include/uninstall_sequoiadb.inc
